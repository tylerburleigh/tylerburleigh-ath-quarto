<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Tyler Burleigh">
<meta name="description" content="I build a machine learning model to predict possible cases of cognitive impairment / dementia in a population of individuals over the age of 60. My data for this model comes from the 2013-2014 NHANES (National Health and Nutrition Examination Survey) study cohort, which is a nationally representative, longitudinal study of health in the US.">

<title>Modeling cognitive impairment using NHANES data | Tyler Burleigh – Tyler Burleigh</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../">
<link href="../../../..//files/favico.png" rel="icon" type="image/png">
<script src="../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting-dd08061cb7210c315e315379d94beb87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../site_libs/bootstrap/bootstrap-1f84303a6b4423b6cbd3f2cacdf6faa2.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../../../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-PRHQZ8HPLB"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-PRHQZ8HPLB', { 'anonymize_ip': true});
</script>
<style>

      .quarto-title-block .quarto-title-banner {
        background: #170C3A;
      }
</style>


<meta property="og:title" content="Modeling cognitive impairment using NHANES data | Tyler Burleigh">
<meta property="og:description" content="I build a machine learning model to predict possible cases of cognitive impairment / dementia in a population of individuals over the age of 60. My data for this model comes from the 2013-2014 NHANES (National Health and Nutrition Examination Survey) study cohort, which is a nationally representative, longitudinal study of health in the US.">
<meta property="og:image" content="https://tylerburleigh.com/blog/2020/05/12/social-image.png">
<meta property="og:site_name" content="Tyler Burleigh">
<meta property="og:image:height" content="262">
<meta property="og:image:width" content="386">
<meta name="twitter:title" content="Modeling cognitive impairment using NHANES data | Tyler Burleigh">
<meta name="twitter:description" content="I build a machine learning model to predict possible cases of cognitive impairment / dementia in a population of individuals over the age of 60. My data for this model comes from the 2013-2014 NHANES (National Health and Nutrition Examination Survey) study cohort, which is a nationally representative, longitudinal study of health in the US.">
<meta name="twitter:image" content="https://tylerburleigh.com/blog/2020/05/12/social-image.png">
<meta name="twitter:image-height" content="262">
<meta name="twitter:image-width" content="386">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="floating nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../../index.html">
    <span class="navbar-title">Tyler Burleigh</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../index.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../cv/index.html"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../research/index.html"> 
<span class="menu-text">Research</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://fosstodon.org/users/tylerburleigh" rel="me"> <i class="bi bi-mastodon" role="img" aria-label="mastodon">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://bsky.app/profile/tylerburleigh.bsky.social" rel="me"> <i class="bi bi-square" role="img" aria-label="bluesky">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/tylerburleigh" rel="me"> <i class="bi bi-github" role="img" aria-label="github">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/tylerburleigh" rel="me"> <i class="bi bi-linkedin" role="img" aria-label="linkedin">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:tylerburleigh@gmail.com" rel="me"> <i class="bi bi-envelope" role="img" aria-label="email">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default blog-post page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Modeling cognitive impairment using NHANES data</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
                  <div>
        <div class="description">
          I build a machine learning model to predict possible cases of cognitive impairment / dementia in a population of individuals over the age of 60. My data for this model comes from the 2013-2014 NHANES (National Health and Nutrition Examination Survey) study cohort, which is a nationally representative, longitudinal study of health in the US.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">python</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p><a href="https://www.tylerburleigh.com/">Tyler Burleigh</a> </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">Tuesday, May 12, 2020</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#cognitive-functioning-data" id="toc-cognitive-functioning-data" class="nav-link active" data-scroll-target="#cognitive-functioning-data">Cognitive functioning data</a></li>
  <li><a href="#number-of-observations" id="toc-number-of-observations" class="nav-link" data-scroll-target="#number-of-observations">Number of observations</a></li>
  <li><a href="#score-distributions" id="toc-score-distributions" class="nav-link" data-scroll-target="#score-distributions">Score distributions</a></li>
  <li><a href="#composite-scoring" id="toc-composite-scoring" class="nav-link" data-scroll-target="#composite-scoring">Composite scoring</a></li>
  <li><a href="#what-is-low-cognition" id="toc-what-is-low-cognition" class="nav-link" data-scroll-target="#what-is-low-cognition">What is “low” cognition?</a></li>
  <li><a href="#model-features" id="toc-model-features" class="nav-link" data-scroll-target="#model-features">Model features</a>
  <ul class="collapse">
  <li><a href="#recoding-variables" id="toc-recoding-variables" class="nav-link" data-scroll-target="#recoding-variables">Recoding variables</a></li>
  <li><a href="#missing-values" id="toc-missing-values" class="nav-link" data-scroll-target="#missing-values">Missing values</a></li>
  </ul></li>
  <li><a href="#preprocessing" id="toc-preprocessing" class="nav-link" data-scroll-target="#preprocessing">Preprocessing</a></li>
  <li><a href="#xgboost-model" id="toc-xgboost-model" class="nav-link" data-scroll-target="#xgboost-model">XGBoost model</a>
  <ul class="collapse">
  <li><a href="#baseline-model" id="toc-baseline-model" class="nav-link" data-scroll-target="#baseline-model">Baseline model</a>
  <ul class="collapse">
  <li><a href="#test-performance" id="toc-test-performance" class="nav-link" data-scroll-target="#test-performance">Test performance</a></li>
  </ul></li>
  <li><a href="#biasing-the-model-towards-specificity" id="toc-biasing-the-model-towards-specificity" class="nav-link" data-scroll-target="#biasing-the-model-towards-specificity">Biasing the model towards specificity</a></li>
  <li><a href="#model-with-hyperparameter-tuning" id="toc-model-with-hyperparameter-tuning" class="nav-link" data-scroll-target="#model-with-hyperparameter-tuning">Model with hyperparameter tuning</a>
  <ul class="collapse">
  <li><a href="#test-performance-1" id="toc-test-performance-1" class="nav-link" data-scroll-target="#test-performance-1">Test performance</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content">





<p>In this blog post, I build a machine learning model to predict possible cases of cognitive impairment / dementia in a population of individuals over the age of 60. My data for this model comes from the 2013-2014 NHANES (National Health and Nutrition Examination Survey) study cohort, which is a nationally representative, longitudinal study of health in the US.</p>
<p>As an outcome measure, I’ll create a composite index of cognition by combining data from the Animal Fluency and Digit Symbol Substitution tasks. As predictors of this outcome, I’ll pull together variables that seem relevant to predicting dementia at a population level. For example, variables like age, race, gender, BMI, depression symptoms, alcohol use, blood lead levels, etc.</p>
<p>I’ll use xgboost to train the model, and I’ll walk through a hypothetical use-case for the model, discussing what might be the appropriate model bias (e.g., specificity/recall).</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> wget</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The data is obtained from the <a href="https://wwwn.cdc.gov/nchs/nhanes/search/datapage.aspx?Component=Questionnaire&amp;CycleBeginYear=2013">NHANES website</a>, for the 2013-2014 study cohort.</p>
<p>Data files are converted from XPT to CSV.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Base path for downloading</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>base <span class="op">=</span> <span class="st">'https://wwwn.cdc.gov/Nchs/Nhanes/2013-2014/'</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Files to download</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>files <span class="op">=</span> [<span class="st">'DEMO_H.XPT'</span>, <span class="st">'CFQ_H.XPT'</span>, <span class="st">'COT_H.XPT'</span>, <span class="st">'BPX_H.XPT'</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">'BMX_H.XPT'</span>, <span class="st">'MGX_H.XPT'</span>, <span class="st">'CSX_H.XPT'</span>, <span class="st">'HSQ_H.XPT'</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">'DIQ_H.XPT'</span>, <span class="st">'DPQ_H.XPT'</span>, <span class="st">'ALQ_H.XPT'</span>, <span class="st">'SLQ_H.XPT'</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">'VID_H.XPT'</span>, <span class="st">'VITB12_H.XPT'</span>, <span class="st">'DBQ_H.XPT'</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'PBCD_H.XPT'</span>, <span class="st">'BIOPRO_H.XPT'</span>, <span class="st">'INQ_H.XPT'</span>]</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> files:</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    xpt_file <span class="op">=</span> <span class="st">'data/'</span> <span class="op">+</span> <span class="bu">file</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    csv_file <span class="op">=</span> xpt_file <span class="op">+</span> <span class="st">'.csv'</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    wget.download(base <span class="op">+</span> <span class="bu">file</span>, xpt_file)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">!</span>xport $xpt_file <span class="op">&gt;</span> $csv_file</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>100% [..........................................................................] 1223920 / 1223920</code></pre>
<p>Read the files into a single dataframe by joining on participant ID (<code>SEQN</code>).</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read first file</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'data/DEMO_H.XPT.csv'</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through remaining files and join together</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> files[<span class="dv">1</span>:]:</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    tmp <span class="op">=</span> pd.read_csv(<span class="st">'data/'</span> <span class="op">+</span> <span class="bu">file</span> <span class="op">+</span> <span class="st">'.csv'</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.join(tmp.set_index(<span class="st">'SEQN'</span>), on<span class="op">=</span><span class="st">'SEQN'</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop duplicates by SEQN</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>df.drop_duplicates(subset<span class="op">=</span><span class="st">'SEQN'</span>, keep<span class="op">=</span><span class="st">'first'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>(10175, 393)</code></pre>
<section id="cognitive-functioning-data" class="level2">
<h2 class="anchored" data-anchor-id="cognitive-functioning-data">Cognitive functioning data</h2>
<p>This dataset contains multiple tests on which cognitive functioning was assessed. For this analysis, I will be considering the Animal Fluency Task (AFT) and the Digit Symbol Substitution Task (DSST). These tasks measure different aspects of cognition.</p>
<p>In past research, these tasks have each been shown to discriminate between populations with and without dementia. For example, see <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2880929">Howe (2007)</a> or <a href="https://academic.oup.com/ageing/article/45/5/688/2236919">Rosano et al.&nbsp;[2016]</a>.</p>
<p>I will take these measures and combine them to create a composite measure of cognition. By creating a composite, I will be able to reduce measurement noise or bias.</p>
<p>To create a composite, I will first “standardize” each score using z-score normalization so that each score represents a standardized difference from the the mean of its distribution. I will then take the average of the standardized scores.</p>
</section>
<section id="number-of-observations" class="level2">
<h2 class="anchored" data-anchor-id="number-of-observations">Number of observations</h2>
<p>According to the <a href="https://wwwn.cdc.gov/Nchs/Nhanes/2013-2014/CFQ_H.htm#CFDAST">documentation on NHANES</a>, there should be 1661 individuals with scores on the Animal Fluency Task (AFT), and 1592 participants with scores on the Digit Symbol Substitution Task (DSST). Here we can see that the intersection of individuals who completed AFT and DSST tasks is 1575.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(df)) <span class="co"># All participants in the dataset</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(df[df[<span class="st">'RIDAGEYR'</span>] <span class="op">&gt;</span> <span class="dv">60</span>])) <span class="co"># All participants over 60</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">'CFDAST'</span>].notnull().<span class="bu">sum</span>()) <span class="co"># Participants with AFT scores</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">'CFDDS'</span>].notnull().<span class="bu">sum</span>()) <span class="co"># Participants with DSST scores</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(df[df[<span class="st">'CFDAST'</span>].notnull() <span class="op">&amp;</span> df[<span class="st">'CFDDS'</span>].notnull()]) <span class="co"># Individuals with both AFT and DSST</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> df[df[<span class="st">'CFDAST'</span>].notnull() <span class="op">&amp;</span> df[<span class="st">'CFDDS'</span>].notnull()].reset_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>10175
1729
1661
1592</code></pre>
</section>
<section id="score-distributions" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="score-distributions">Score distributions</h2>
<p>Below we can see that the distribution of scores on each task are approximately normal.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>plt.hist(df2[<span class="st">'CFDAST'</span>], bins<span class="op">=</span><span class="dv">35</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Animal Fluency Scores"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>plt.hist(df2[<span class="st">'CFDDS'</span>], bins<span class="op">=</span><span class="dv">35</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Digit Symbol Substitution Scores"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="output_13_0.png" class="img-fluid figure-img"></p>
<figcaption class="margin-caption">png</figcaption>
</figure>
</div>
<pre><code>Text(0.5, 1.0, 'Digit Symbol Substitution Scores')</code></pre>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="output_13_2.png" class="img-fluid figure-img"></p>
<figcaption class="margin-caption">png</figcaption>
</figure>
</div>
</section>
<section id="composite-scoring" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="composite-scoring">Composite scoring</h2>
<p>First I’ll standardize each of the test columns.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> zscore</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>df2[<span class="st">'DSST_z'</span>] <span class="op">=</span> df2[<span class="st">'CFDDS'</span>].pipe(zscore)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>df2[<span class="st">'AFT_z'</span>] <span class="op">=</span> df2[<span class="st">'CFDAST'</span>].pipe(zscore)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Next, I’ll create a composite by taking the average of the two standardized scores.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>df2[<span class="st">'COG'</span>] <span class="op">=</span> (df2[<span class="st">'DSST_z'</span>] <span class="op">+</span> df2[<span class="st">'AFT_z'</span>]) <span class="op">/</span> <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Finally, I’ll check to make sure that the distribution of composite scores is still normal.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>plt.hist(df2[<span class="st">'COG'</span>], bins<span class="op">=</span><span class="dv">35</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Composite Cognition"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>Text(0.5, 1.0, 'Composite Cognition')</code></pre>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="output_20_1.png" class="img-fluid figure-img"></p>
<figcaption class="margin-caption">png</figcaption>
</figure>
</div>
</section>
<section id="what-is-low-cognition" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="what-is-low-cognition">What is “low” cognition?</h2>
<p>Since these are standardized scores, we can say that low cognition represents 1 standardized unit below the mean.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>plt.hist(df2[<span class="st">'COG'</span>], bins<span class="op">=</span><span class="dv">35</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>plt.axvline(x<span class="op">=-</span><span class="dv">1</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Composite Cognition with Threshold"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>Text(0.5, 1.0, 'Composite Cognition with Threshold')</code></pre>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="output_22_1.png" class="img-fluid figure-img"></p>
<figcaption class="margin-caption">png</figcaption>
</figure>
</div>
<p>I’ll create a variable to track this classification.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>df2[<span class="st">'COG_low'</span>] <span class="op">=</span> df2[<span class="st">'COG'</span>] <span class="op">&lt;</span> <span class="op">-</span><span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="model-features" class="level2">
<h2 class="anchored" data-anchor-id="model-features">Model features</h2>
<p>I’ll collect all the features that I think might be interesting.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> {<span class="co"># Composite cognition score</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>            <span class="st">'COG'</span>: <span class="st">'cognition'</span>,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">'COG_low'</span>: <span class="st">'cognition_impaired'</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Demographics</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">'RIAGENDR'</span>: <span class="st">'gender'</span>, </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">'RIDAGEYR'</span>: <span class="st">'age'</span>,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">'RIDRETH1'</span>: <span class="st">'race'</span>,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Poverty level</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">'INDFMMPI'</span>: <span class="st">'poverty'</span>,</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Body mass index</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">'BMXBMI'</span>: <span class="st">'bmi'</span>,</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Alcohol use</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ALQ120Q'</span>: <span class="st">'alcohol_days'</span>,</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Blood vitamin levels</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">'LBXVIDMS'</span>: <span class="st">'vit_d'</span>,</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">'LBDB12'</span>: <span class="st">'vit_b12'</span>,</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Diet</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>            <span class="st">'DBQ700'</span>: <span class="st">'diet_healthy'</span>,</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Lead</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>            <span class="st">'LBXBPB'</span>: <span class="st">'blood_lead'</span>,</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Blood nicotine metabolite</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>            <span class="st">'LBXCOT'</span>: <span class="st">'cotinine'</span>,</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Grip strength</span></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>            <span class="co"># https://wwwn.cdc.gov/Nchs/Nhanes/2013-2014/MGX_H.htm#MGDCGSZ</span></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>            <span class="st">'MGDCGSZ'</span>: <span class="st">'grip_strength'</span>,</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Smell test</span></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>            <span class="st">'CSXCHOOD'</span>: <span class="st">'smell_choco'</span>,</span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>            <span class="st">'CSXSBOD'</span>: <span class="st">'smell_strawberry'</span>,</span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>            <span class="st">'CSXSMKOD'</span>: <span class="st">'smell_smoke'</span>,</span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>            <span class="st">'CSXLEAOD'</span>: <span class="st">'smell_leather'</span>,</span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>            <span class="st">'CSXSOAOD'</span>: <span class="st">'smell_soap'</span>,</span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>            <span class="st">'CSXGRAOD'</span>: <span class="st">'smell_grape'</span>,</span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>            <span class="st">'CSXONOD'</span>: <span class="st">'smell_onion'</span>,</span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>            <span class="st">'CSXNGSOD'</span>: <span class="st">'smell_gas'</span>,</span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Health in general</span></span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>            <span class="st">'HSD010'</span>: <span class="st">'health_general'</span>,</span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Depression screener</span></span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a>            <span class="st">'DPQ010'</span>: <span class="st">'dep_1'</span>,</span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a>            <span class="st">'DPQ020'</span>: <span class="st">'dep_2'</span>,</span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a>            <span class="st">'DPQ030'</span>: <span class="st">'dep_3'</span>,</span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a>            <span class="st">'DPQ040'</span>: <span class="st">'dep_4'</span>,</span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a>            <span class="st">'DPQ050'</span>: <span class="st">'dep_5'</span>,</span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a>            <span class="st">'DPQ060'</span>: <span class="st">'dep_6'</span>,</span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a>            <span class="st">'DPQ070'</span>: <span class="st">'dep_7'</span>,</span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a>            <span class="st">'DPQ080'</span>: <span class="st">'dep_8'</span>,</span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a>            <span class="st">'DPQ090'</span>: <span class="st">'dep_9'</span>,</span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Sleep</span></span>
<span id="cb18-61"><a href="#cb18-61" aria-hidden="true" tabindex="-1"></a>            <span class="st">'SLD010H'</span>: <span class="st">'sleep'</span>,</span>
<span id="cb18-62"><a href="#cb18-62" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb18-63"><a href="#cb18-63" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Heart rate</span></span>
<span id="cb18-64"><a href="#cb18-64" aria-hidden="true" tabindex="-1"></a>            <span class="st">'BPXPLS'</span>: <span class="st">'heart_rate'</span></span>
<span id="cb18-65"><a href="#cb18-65" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb18-66"><a href="#cb18-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-67"><a href="#cb18-67" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> df2.loc[:, <span class="bu">list</span>(features)]</span>
<span id="cb18-68"><a href="#cb18-68" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> df2.rename(columns<span class="op">=</span>features)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="recoding-variables" class="level3">
<h3 class="anchored" data-anchor-id="recoding-variables">Recoding variables</h3>
<p>Some of the features need to be combined. For example, the smell tests can all be combined into a single “smell test” score; the depression scale can be converted into a single depression score.</p>
<p>On some features the values are numeric but not ordinal. For example, on the depression scale scores 0-3 represent increasing levels of depression symptom severity, but a score of “9” means “don’t know” and a score of “7” means “refused”. This will be important to catch in the variable coding.</p>
<section id="depression-items" class="level4">
<h4 class="anchored" data-anchor-id="depression-items">Depression items</h4>
<p>First I’ll score the depression items. I’ll take the mean of all the items responded to.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>items <span class="op">=</span> [<span class="st">'dep_1'</span>, <span class="st">'dep_2'</span>, <span class="st">'dep_3'</span>, <span class="st">'dep_4'</span>,</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>        <span class="st">'dep_5'</span>, <span class="st">'dep_6'</span>, <span class="st">'dep_7'</span>, <span class="st">'dep_8'</span>,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">'dep_9'</span>]</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> score_depression(x):</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    scores <span class="op">=</span> []</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> item <span class="kw">in</span> items:</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>        value <span class="op">=</span> x[item]</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> value <span class="op">&lt;</span> <span class="dv">4</span>:</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>            scores.append(value)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(scores) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.mean(scores)</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>df2.loc[:, <span class="st">'dep_tot'</span>] <span class="op">=</span> df2.<span class="bu">apply</span>(score_depression, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>df2.drop(items, axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="smell-test" class="level4">
<h4 class="anchored" data-anchor-id="smell-test">Smell test</h4>
<p>Next, I’ll score the smell test items. Each item has one correct response and several incorrect responses. I’ll take the mean number of correct responses.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>items <span class="op">=</span> [<span class="st">'smell_choco'</span>, <span class="st">'smell_strawberry'</span>,</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>         <span class="st">'smell_smoke'</span>, <span class="st">'smell_leather'</span>,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>         <span class="st">'smell_soap'</span>, <span class="st">'smell_grape'</span>,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>         <span class="st">'smell_onion'</span>, <span class="st">'smell_gas'</span>]</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> score_smell(x):</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    scores <span class="op">=</span> []</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x[<span class="st">'smell_choco'</span>] <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>        scores.append(<span class="dv">1</span>)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="op">~</span>np.isnan(x[<span class="st">'smell_choco'</span>]):</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>        scores.append(<span class="dv">0</span>)</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x[<span class="st">'smell_strawberry'</span>] <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>        scores.append(<span class="dv">1</span>)</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="op">~</span>np.isnan(x[<span class="st">'smell_strawberry'</span>]):</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>        scores.append(<span class="dv">0</span>)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x[<span class="st">'smell_smoke'</span>] <span class="op">==</span> <span class="dv">3</span>:</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>        scores.append(<span class="dv">1</span>)</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="op">~</span>np.isnan(x[<span class="st">'smell_smoke'</span>]):</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>        scores.append(<span class="dv">0</span>)</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x[<span class="st">'smell_leather'</span>] <span class="op">==</span> <span class="dv">3</span>:</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>        scores.append(<span class="dv">1</span>)</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="op">~</span>np.isnan(x[<span class="st">'smell_leather'</span>]):</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>        scores.append(<span class="dv">0</span>)</span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x[<span class="st">'smell_soap'</span>] <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>        scores.append(<span class="dv">1</span>)</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="op">~</span>np.isnan(x[<span class="st">'smell_soap'</span>]):</span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>        scores.append(<span class="dv">0</span>)</span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x[<span class="st">'smell_grape'</span>] <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>        scores.append(<span class="dv">1</span>)</span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="op">~</span>np.isnan(x[<span class="st">'smell_grape'</span>]):</span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>        scores.append(<span class="dv">0</span>)</span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x[<span class="st">'smell_onion'</span>] <span class="op">==</span> <span class="dv">3</span>:</span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>        scores.append(<span class="dv">1</span>)</span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="op">~</span>np.isnan(x[<span class="st">'smell_onion'</span>]):</span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>        scores.append(<span class="dv">0</span>)</span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x[<span class="st">'smell_gas'</span>] <span class="op">==</span> <span class="dv">4</span>:</span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>        scores.append(<span class="dv">1</span>)</span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="op">~</span>np.isnan(x[<span class="st">'smell_gas'</span>]):</span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>        scores.append(<span class="dv">0</span>)</span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(scores) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.nanmean(scores)</span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a>df2.loc[:, <span class="st">'smell_tot'</span>] <span class="op">=</span> df2.<span class="bu">apply</span>(score_smell, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a>df2.drop(items, axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="others" class="level4">
<h4 class="anchored" data-anchor-id="others">Others</h4>
<p>Replace “Don’t know” and “Refused” with missing.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>df2[<span class="st">'health_general'</span>].replace([<span class="fl">9.0</span>, <span class="fl">7.0</span>], [np.nan, np.nan], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>df2[<span class="st">'sleep'</span>].replace([<span class="fl">99.0</span>, <span class="fl">77.0</span>], [np.nan, np.nan], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>df2[<span class="st">'alcohol_days'</span>].replace([<span class="fl">999.0</span>, <span class="fl">777.0</span>], [np.nan, np.nan], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>df2[<span class="st">'diet_healthy'</span>].replace([<span class="fl">9.0</span>, <span class="fl">7.0</span>], [np.nan, np.nan], inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="missing-values" class="level3">
<h3 class="anchored" data-anchor-id="missing-values">Missing values</h3>
<p>How many values are missing in each column?</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'% missing values'</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="bu">round</span>(df2.isnull().<span class="bu">sum</span>() <span class="op">/</span> <span class="bu">len</span>(df2) <span class="op">*</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>% missing values





cognition              0.0
cognition_impaired     0.0
gender                 0.0
age                    0.0
race                   0.0
poverty               11.0
bmi                    1.0
alcohol_days          18.0
vit_d                  3.0
vit_b12                4.0
diet_healthy           0.0
blood_lead            51.0
cotinine               4.0
grip_strength         11.0
health_general         2.0
sleep                  0.0
heart_rate             3.0
dep_tot                2.0
smell_tot              3.0
dtype: float64</code></pre>
</section>
</section>
<section id="preprocessing" class="level1">
<h1>Preprocessing</h1>
<p>I will use median imputation for missing numeric values.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> ColumnTransformer</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> LabelEncoder, OneHotEncoder</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.impute <span class="im">import</span> SimpleImputer</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df2.drop([<span class="st">'cognition'</span>, <span class="st">'cognition_impaired'</span>], axis<span class="op">=</span><span class="dv">1</span>) <span class="co"># Features</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df2[<span class="st">'cognition'</span>] <span class="co"># Outcome raw</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>y2 <span class="op">=</span> df2[<span class="st">'cognition_impaired'</span>] <span class="co"># Outcome binary</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>ct <span class="op">=</span> ColumnTransformer(</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">#('ohe', OneHotEncoder(sparse=False, handle_unknown='ignore'), [1, 3]),</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'impute'</span>, SimpleImputer(strategy<span class="op">=</span><span class="st">'median'</span>), [<span class="dv">0</span>, <span class="op">-</span><span class="dv">2</span>]),</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    remainder<span class="op">=</span><span class="st">'passthrough'</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>X_arr <span class="op">=</span> ct.fit_transform(X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="xgboost-model" class="level1 page-columns page-full">
<h1>XGBoost model</h1>
<p>Next I’ll train a model to predict the composite cognition score using xgboost.</p>
<p>I’ll stratify the train-test split on the classification of healthy/impaired cognition.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> xgboost <span class="im">import</span> XGBRegressor, XGBClassifier</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> xgboost <span class="im">import</span> plot_importance</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split, RandomizedSearchCV</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, precision_score, recall_score, roc_curve, roc_auc_score, plot_roc_curve, confusion_matrix</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X_arr, y2, </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>                                                    test_size<span class="op">=</span><span class="fl">0.2</span>, </span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>                                                    random_state<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>                                                    stratify<span class="op">=</span>y2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="baseline-model" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="baseline-model">Baseline model</h2>
<p>I’ll train a baseline xgboost model, without any parameter tuning. This will give me a general sense of the model’s performance.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> XGBClassifier()</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>model.fit(X_train, y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>XGBClassifier(base_score=0.5, booster=None, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, gamma=0, gpu_id=-1,
              importance_type='gain', interaction_constraints=None,
              learning_rate=0.300000012, max_delta_step=0, max_depth=6,
              min_child_weight=1, missing=nan, monotone_constraints=None,
              n_estimators=100, n_jobs=0, num_parallel_tree=1,
              objective='binary:logistic', random_state=0, reg_alpha=0,
              reg_lambda=1, scale_pos_weight=1, subsample=1, tree_method=None,
              validate_parameters=False, verbosity=None)</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>model.score(X_test, y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>0.8571428571428571</code></pre>
<section id="test-performance" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="test-performance">Test performance</h3>
<p>How did the model perform on the test set?</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> model.predict(X_test)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Accuracy: </span><span class="sc">%.2f%%</span><span class="st">"</span> <span class="op">%</span> (accuracy_score(y_test, preds) <span class="op">*</span> <span class="fl">100.0</span>))</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Precision: </span><span class="sc">%.2f%%</span><span class="st">"</span> <span class="op">%</span> (precision_score(y_test, preds) <span class="op">*</span> <span class="fl">100.0</span>))</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Recall: </span><span class="sc">%.2f%%</span><span class="st">"</span> <span class="op">%</span> (recall_score(y_test, preds) <span class="op">*</span> <span class="fl">100.0</span>))</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>plot_roc_curve(model, X_test, y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>Accuracy: 85.71%
Precision: 40.91%
Recall: 21.95%





&lt;sklearn.metrics._plot.roc_curve.RocCurveDisplay at 0x25115f7c7c8&gt;</code></pre>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="output_45_2.png" class="img-fluid figure-img"></p>
<figcaption class="margin-caption">png</figcaption>
</figure>
</div>
<div class="sourceCode" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>tn, fp, fn, tp <span class="op">=</span> confusion_matrix(y_test, preds).ravel()</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"True Pos: </span><span class="sc">{</span>tp<span class="sc">}</span><span class="ss">"</span> , <span class="ss">f"</span><span class="ch">\n</span><span class="ss">False Neg: </span><span class="sc">{</span>fn<span class="sc">}</span><span class="ss">"</span>, <span class="ss">f"</span><span class="ch">\n</span><span class="ss">False Pos: </span><span class="sc">{</span>fp<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>True Pos: 9 
False Neg: 32 
False Pos: 13</code></pre>
</section>
</section>
<section id="biasing-the-model-towards-specificity" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="biasing-the-model-towards-specificity">Biasing the model towards specificity</h2>
<p>The model didn’t perform very well on specificity (a.k.a. recall), meaning that among the 41 individuals with cognitive impairment, the model was only able to correctly identify 22% of them.</p>
<p>Let’s imagine a scenario in which we might want to bias the model towards high specificity:</p>
<p>Imagine the model is will be used to identify possible cases of dementia and when the model identifies a case of dementia they will be invited back for further testing to make a diagnosis with much higher precision. In this case, false positives would arguably carry a low risk because (let’s say for the sake of argument) further testing will be harmless and individuals who are healthy will be discovered as healthy. On the other side of the equation, let’s say that there is a high risk of negative consequences for anyone cases of dementia that go missed (and therefore untreated).</p>
<p>This is a case where we would want to optimize for detecting cases of dementia at risk of having an inflated false-positive rate.</p>
<p>Now, one of the reasons for poor recall performance was the imbalanced classes used to train the data. That is to say, the impaired class had many fewer examples than the healthy class. I can correct for this using a weighting parameter when I instantiate the model, setting it to the ratio of healthy-to-impaired examples.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>impaired <span class="op">=</span> <span class="bu">len</span>(df2[df2[<span class="st">'cognition_impaired'</span>] <span class="op">==</span> <span class="va">True</span>])</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>healthy <span class="op">=</span> <span class="bu">len</span>(df2[df2[<span class="st">'cognition_impaired'</span>] <span class="op">==</span> <span class="va">False</span>])</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>imbalance_ratio <span class="op">=</span> healthy <span class="op">/</span> impaired</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(imbalance_ratio)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>6.720588235294118</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> XGBClassifier(scale_pos_weight <span class="op">=</span> imbalance_ratio)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>model.fit(X_train, y_train)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>model.score(X_test, y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>0.8444444444444444</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> model.predict(X_test)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Accuracy: </span><span class="sc">%.2f%%</span><span class="st">"</span> <span class="op">%</span> (accuracy_score(y_test, preds) <span class="op">*</span> <span class="fl">100.0</span>))</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Precision: </span><span class="sc">%.2f%%</span><span class="st">"</span> <span class="op">%</span> (precision_score(y_test, preds) <span class="op">*</span> <span class="fl">100.0</span>))</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Recall: </span><span class="sc">%.2f%%</span><span class="st">"</span> <span class="op">%</span> (recall_score(y_test, preds) <span class="op">*</span> <span class="fl">100.0</span>))</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>plot_roc_curve(model, X_test, y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>Accuracy: 84.44%
Precision: 39.47%
Recall: 36.59%





&lt;sklearn.metrics._plot.roc_curve.RocCurveDisplay at 0x25116152d08&gt;</code></pre>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="output_50_2.png" class="img-fluid figure-img"></p>
<figcaption class="margin-caption">png</figcaption>
</figure>
</div>
<div class="sourceCode" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>tn, fp, fn, tp <span class="op">=</span> confusion_matrix(y_test, preds).ravel()</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"True Pos: </span><span class="sc">{</span>tp<span class="sc">}</span><span class="ss">"</span> , <span class="ss">f"</span><span class="ch">\n</span><span class="ss">False Neg: </span><span class="sc">{</span>fn<span class="sc">}</span><span class="ss">"</span>, <span class="ss">f"</span><span class="ch">\n</span><span class="ss">False Pos: </span><span class="sc">{</span>fp<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>True Pos: 15 
False Neg: 26 
False Pos: 23</code></pre>
</section>
<section id="model-with-hyperparameter-tuning" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="model-with-hyperparameter-tuning">Model with hyperparameter tuning</h2>
<p>I’ve managed to bias the model to improve its specificity. This has resulted in more true positives at the cost of more false positives. But I think I can improve this metric even further by searching through the “hyperparameter space” and considering alternative models that optimize for this metric. This is what I’ll do next using random search.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameter grid</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>gbm_param_grid <span class="op">=</span> {</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'n_estimators'</span>: np.arange(<span class="dv">20</span>, <span class="dv">100</span>, <span class="dv">10</span>),</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'max_depth'</span>: <span class="bu">range</span>(<span class="dv">2</span>, <span class="dv">10</span>),</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'colsample_bytree'</span>: np.arange(<span class="fl">0.1</span>, <span class="fl">1.0</span>, <span class="fl">0.005</span>),</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'eta'</span>: np.arange(<span class="fl">0.1</span>, <span class="fl">1.0</span>, <span class="fl">0.01</span>),</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'scale_pos_weight'</span>: [imbalance_ratio]</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize regressor</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>gbm <span class="op">=</span> XGBClassifier()</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Random search</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>randomized_mse <span class="op">=</span> RandomizedSearchCV(param_distributions<span class="op">=</span>gbm_param_grid, </span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>                                    estimator<span class="op">=</span>gbm, </span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>                                    scoring<span class="op">=</span><span class="st">'recall'</span>, </span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>                                    n_iter<span class="op">=</span><span class="dv">500</span>, </span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>                                    cv<span class="op">=</span><span class="dv">4</span>, </span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>                                    random_state<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>                                    verbose<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit to data</span></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>randomized_mse.fit(X_train, y_train)</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the best parameters and lowest RMSE</span></span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Best parameters found: "</span>, randomized_mse.best_params_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>Fitting 4 folds for each of 500 candidates, totalling 2000 fits


[Parallel(n_jobs=1)]: Using backend SequentialBackend with 1 concurrent workers.


Best parameters found:  {'scale_pos_weight': 6.720588235294118, 'n_estimators': 20, 'max_depth': 2, 'eta': 0.21999999999999995, 'colsample_bytree': 0.49500000000000033}


[Parallel(n_jobs=1)]: Done 2000 out of 2000 | elapsed:  2.1min finished</code></pre>
<section id="test-performance-1" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="test-performance-1">Test performance</h3>
<div class="sourceCode" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> randomized_mse.predict(X_test)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Accuracy: </span><span class="sc">%.2f%%</span><span class="st">"</span> <span class="op">%</span> (accuracy_score(y_test, preds) <span class="op">*</span> <span class="fl">100.0</span>))</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Precision: </span><span class="sc">%.2f%%</span><span class="st">"</span> <span class="op">%</span> (precision_score(y_test, preds) <span class="op">*</span> <span class="fl">100.0</span>))</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Recall: </span><span class="sc">%.2f%%</span><span class="st">"</span> <span class="op">%</span> (recall_score(y_test, preds) <span class="op">*</span> <span class="fl">100.0</span>))</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>plot_roc_curve(randomized_mse, X_test, y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>Accuracy: 72.38%
Precision: 27.00%
Recall: 65.85%





&lt;sklearn.metrics._plot.roc_curve.RocCurveDisplay at 0x251159b4a88&gt;</code></pre>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="output_55_2.png" class="img-fluid figure-img"></p>
<figcaption class="margin-caption">png</figcaption>
</figure>
</div>
<div class="sourceCode" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>tn, fp, fn, tp <span class="op">=</span> confusion_matrix(y_test, preds).ravel()</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"True Pos: </span><span class="sc">{</span>tp<span class="sc">}</span><span class="ss">"</span> , <span class="ss">f"</span><span class="ch">\n</span><span class="ss">False Neg: </span><span class="sc">{</span>fn<span class="sc">}</span><span class="ss">"</span>, <span class="ss">f"</span><span class="ch">\n</span><span class="ss">False Pos: </span><span class="sc">{</span>fp<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>True Pos: 27 
False Neg: 14 
False Pos: 73</code></pre>


<!-- -->

</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/tylerburleigh\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="tylerburleigh/tylerburleigh.github.io" data-repo-id="R_kgDOKMo8ww" data-category="Blog comments" data-category-id="DIC_kwDOIg6EJc4CSz92" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark"><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb48" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> 'Modeling cognitive impairment using NHANES data'</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> '2020-05-12'</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> 'I build a machine learning model to predict possible cases of cognitive impairment / dementia in a population of individuals over the age of 60. My data for this model comes from the 2013-2014 NHANES (National Health and Nutrition Examination Survey) study cohort, which is a nationally representative, longitudinal study of health in the US.'</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> social-image.png</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="an">twitter-card:</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="co">  image: "social-image.png"</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="an">open-graph:</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="co">  image: "social-image.png"</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="co">  - python</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a><span class="an">freeze:</span><span class="co"> true</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>In this blog post, I build a machine learning model to predict possible cases of cognitive impairment / dementia in a population of individuals over the age of 60. My data for this model comes from the 2013-2014 NHANES (National Health and Nutrition Examination Survey) study cohort, which is a nationally representative, longitudinal study of health in the US.</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>As an outcome measure, I'll create a composite index of cognition by combining data from the Animal Fluency and Digit Symbol Substitution tasks. As predictors of this outcome, I'll pull together variables that seem relevant to predicting dementia at a population level. For example, variables like age, race, gender, BMI, depression symptoms, alcohol use, blood lead levels, etc.</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>I'll use xgboost to train the model, and I'll walk through a hypothetical use-case for the model, discussing what might be the appropriate model bias (e.g., specificity/recall).</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> wget</span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a>The data is obtained from the <span class="co">[</span><span class="ot">NHANES website</span><span class="co">](https://wwwn.cdc.gov/nchs/nhanes/search/datapage.aspx?Component=Questionnaire&amp;CycleBeginYear=2013)</span>, for the 2013-2014 study cohort. </span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a>Data files are converted from XPT to CSV.</span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Base path for downloading</span></span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a>base <span class="op">=</span> <span class="st">'https://wwwn.cdc.gov/Nchs/Nhanes/2013-2014/'</span></span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Files to download</span></span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a>files <span class="op">=</span> [<span class="st">'DEMO_H.XPT'</span>, <span class="st">'CFQ_H.XPT'</span>, <span class="st">'COT_H.XPT'</span>, <span class="st">'BPX_H.XPT'</span>,</span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a>        <span class="st">'BMX_H.XPT'</span>, <span class="st">'MGX_H.XPT'</span>, <span class="st">'CSX_H.XPT'</span>, <span class="st">'HSQ_H.XPT'</span>,</span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a>        <span class="st">'DIQ_H.XPT'</span>, <span class="st">'DPQ_H.XPT'</span>, <span class="st">'ALQ_H.XPT'</span>, <span class="st">'SLQ_H.XPT'</span>,</span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a>        <span class="st">'VID_H.XPT'</span>, <span class="st">'VITB12_H.XPT'</span>, <span class="st">'DBQ_H.XPT'</span>,</span>
<span id="cb48-44"><a href="#cb48-44" aria-hidden="true" tabindex="-1"></a>        <span class="st">'PBCD_H.XPT'</span>, <span class="st">'BIOPRO_H.XPT'</span>, <span class="st">'INQ_H.XPT'</span>]</span>
<span id="cb48-45"><a href="#cb48-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-46"><a href="#cb48-46" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> files:</span>
<span id="cb48-47"><a href="#cb48-47" aria-hidden="true" tabindex="-1"></a>    xpt_file <span class="op">=</span> <span class="st">'data/'</span> <span class="op">+</span> <span class="bu">file</span></span>
<span id="cb48-48"><a href="#cb48-48" aria-hidden="true" tabindex="-1"></a>    csv_file <span class="op">=</span> xpt_file <span class="op">+</span> <span class="st">'.csv'</span></span>
<span id="cb48-49"><a href="#cb48-49" aria-hidden="true" tabindex="-1"></a>    wget.download(base <span class="op">+</span> <span class="bu">file</span>, xpt_file)</span>
<span id="cb48-50"><a href="#cb48-50" aria-hidden="true" tabindex="-1"></a>    <span class="op">!</span>xport $xpt_file <span class="op">&gt;</span> $csv_file</span>
<span id="cb48-51"><a href="#cb48-51" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-52"><a href="#cb48-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-53"><a href="#cb48-53" aria-hidden="true" tabindex="-1"></a><span class="in">    100% [..........................................................................] 1223920 / 1223920</span></span>
<span id="cb48-54"><a href="#cb48-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-55"><a href="#cb48-55" aria-hidden="true" tabindex="-1"></a>Read the files into a single dataframe by joining on participant ID (<span class="in">`SEQN`</span>).</span>
<span id="cb48-56"><a href="#cb48-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-57"><a href="#cb48-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-58"><a href="#cb48-58" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb48-59"><a href="#cb48-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Read first file</span></span>
<span id="cb48-60"><a href="#cb48-60" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'data/DEMO_H.XPT.csv'</span>)</span>
<span id="cb48-61"><a href="#cb48-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-62"><a href="#cb48-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through remaining files and join together</span></span>
<span id="cb48-63"><a href="#cb48-63" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> files[<span class="dv">1</span>:]:</span>
<span id="cb48-64"><a href="#cb48-64" aria-hidden="true" tabindex="-1"></a>    tmp <span class="op">=</span> pd.read_csv(<span class="st">'data/'</span> <span class="op">+</span> <span class="bu">file</span> <span class="op">+</span> <span class="st">'.csv'</span>)</span>
<span id="cb48-65"><a href="#cb48-65" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.join(tmp.set_index(<span class="st">'SEQN'</span>), on<span class="op">=</span><span class="st">'SEQN'</span>)</span>
<span id="cb48-66"><a href="#cb48-66" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-67"><a href="#cb48-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop duplicates by SEQN</span></span>
<span id="cb48-68"><a href="#cb48-68" aria-hidden="true" tabindex="-1"></a>df.drop_duplicates(subset<span class="op">=</span><span class="st">'SEQN'</span>, keep<span class="op">=</span><span class="st">'first'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb48-69"><a href="#cb48-69" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-70"><a href="#cb48-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-71"><a href="#cb48-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-72"><a href="#cb48-72" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb48-73"><a href="#cb48-73" aria-hidden="true" tabindex="-1"></a>df.shape</span>
<span id="cb48-74"><a href="#cb48-74" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-75"><a href="#cb48-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-76"><a href="#cb48-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-77"><a href="#cb48-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-78"><a href="#cb48-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-79"><a href="#cb48-79" aria-hidden="true" tabindex="-1"></a><span class="in">    (10175, 393)</span></span>
<span id="cb48-80"><a href="#cb48-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-81"><a href="#cb48-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-82"><a href="#cb48-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-83"><a href="#cb48-83" aria-hidden="true" tabindex="-1"></a><span class="fu">## Cognitive functioning data</span></span>
<span id="cb48-84"><a href="#cb48-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-85"><a href="#cb48-85" aria-hidden="true" tabindex="-1"></a>This dataset contains multiple tests on which cognitive functioning was assessed. For this analysis, I will be considering the Animal Fluency Task (AFT) and the Digit Symbol Substitution Task (DSST). These tasks measure different aspects of cognition. </span>
<span id="cb48-86"><a href="#cb48-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-87"><a href="#cb48-87" aria-hidden="true" tabindex="-1"></a>In past research, these tasks have each been shown to discriminate between populations with and without dementia. For example, see <span class="co">[</span><span class="ot">Howe (2007)</span><span class="co">](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2880929)</span> or <span class="co">[</span><span class="ot">Rosano et al. [2016]</span><span class="co">](https://academic.oup.com/ageing/article/45/5/688/2236919)</span>.</span>
<span id="cb48-88"><a href="#cb48-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-89"><a href="#cb48-89" aria-hidden="true" tabindex="-1"></a>I will take these measures and combine them to create a composite measure of cognition. By creating a composite, I will be able to reduce measurement noise or bias.</span>
<span id="cb48-90"><a href="#cb48-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-91"><a href="#cb48-91" aria-hidden="true" tabindex="-1"></a>To create a composite, I will first "standardize" each score using z-score normalization so that each score represents a standardized difference from the the mean of its distribution. I will then take the average of the standardized scores.</span>
<span id="cb48-92"><a href="#cb48-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-93"><a href="#cb48-93" aria-hidden="true" tabindex="-1"></a><span class="fu">## Number of observations</span></span>
<span id="cb48-94"><a href="#cb48-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-95"><a href="#cb48-95" aria-hidden="true" tabindex="-1"></a>According to the <span class="co">[</span><span class="ot">documentation on NHANES</span><span class="co">](https://wwwn.cdc.gov/Nchs/Nhanes/2013-2014/CFQ_H.htm#CFDAST)</span>, there should be 1661 individuals with scores on the Animal Fluency Task (AFT), and 1592 participants with scores on the Digit Symbol Substitution Task (DSST). Here we can see that the intersection of individuals who completed AFT and DSST tasks is 1575.</span>
<span id="cb48-96"><a href="#cb48-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-97"><a href="#cb48-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-98"><a href="#cb48-98" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb48-99"><a href="#cb48-99" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(df)) <span class="co"># All participants in the dataset</span></span>
<span id="cb48-100"><a href="#cb48-100" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(df[df[<span class="st">'RIDAGEYR'</span>] <span class="op">&gt;</span> <span class="dv">60</span>])) <span class="co"># All participants over 60</span></span>
<span id="cb48-101"><a href="#cb48-101" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">'CFDAST'</span>].notnull().<span class="bu">sum</span>()) <span class="co"># Participants with AFT scores</span></span>
<span id="cb48-102"><a href="#cb48-102" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">'CFDDS'</span>].notnull().<span class="bu">sum</span>()) <span class="co"># Participants with DSST scores</span></span>
<span id="cb48-103"><a href="#cb48-103" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(df[df[<span class="st">'CFDAST'</span>].notnull() <span class="op">&amp;</span> df[<span class="st">'CFDDS'</span>].notnull()]) <span class="co"># Individuals with both AFT and DSST</span></span>
<span id="cb48-104"><a href="#cb48-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-105"><a href="#cb48-105" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> df[df[<span class="st">'CFDAST'</span>].notnull() <span class="op">&amp;</span> df[<span class="st">'CFDDS'</span>].notnull()].reset_index()</span>
<span id="cb48-106"><a href="#cb48-106" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-107"><a href="#cb48-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-108"><a href="#cb48-108" aria-hidden="true" tabindex="-1"></a><span class="in">    10175</span></span>
<span id="cb48-109"><a href="#cb48-109" aria-hidden="true" tabindex="-1"></a><span class="in">    1729</span></span>
<span id="cb48-110"><a href="#cb48-110" aria-hidden="true" tabindex="-1"></a><span class="in">    1661</span></span>
<span id="cb48-111"><a href="#cb48-111" aria-hidden="true" tabindex="-1"></a><span class="in">    1592</span></span>
<span id="cb48-112"><a href="#cb48-112" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb48-113"><a href="#cb48-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-114"><a href="#cb48-114" aria-hidden="true" tabindex="-1"></a><span class="fu">## Score distributions</span></span>
<span id="cb48-115"><a href="#cb48-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-116"><a href="#cb48-116" aria-hidden="true" tabindex="-1"></a>Below we can see that the distribution of scores on each task are approximately normal.</span>
<span id="cb48-117"><a href="#cb48-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-118"><a href="#cb48-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-119"><a href="#cb48-119" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb48-120"><a href="#cb48-120" aria-hidden="true" tabindex="-1"></a>plt.hist(df2[<span class="st">'CFDAST'</span>], bins<span class="op">=</span><span class="dv">35</span>)</span>
<span id="cb48-121"><a href="#cb48-121" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Animal Fluency Scores"</span>)</span>
<span id="cb48-122"><a href="#cb48-122" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb48-123"><a href="#cb48-123" aria-hidden="true" tabindex="-1"></a>plt.hist(df2[<span class="st">'CFDDS'</span>], bins<span class="op">=</span><span class="dv">35</span>)</span>
<span id="cb48-124"><a href="#cb48-124" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Digit Symbol Substitution Scores"</span>)</span>
<span id="cb48-125"><a href="#cb48-125" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-126"><a href="#cb48-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-127"><a href="#cb48-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-128"><a href="#cb48-128" aria-hidden="true" tabindex="-1"></a><span class="al">![png](output_13_0.png)</span></span>
<span id="cb48-129"><a href="#cb48-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-130"><a href="#cb48-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-131"><a href="#cb48-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-132"><a href="#cb48-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-133"><a href="#cb48-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-134"><a href="#cb48-134" aria-hidden="true" tabindex="-1"></a><span class="in">    Text(0.5, 1.0, 'Digit Symbol Substitution Scores')</span></span>
<span id="cb48-135"><a href="#cb48-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-136"><a href="#cb48-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-137"><a href="#cb48-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-138"><a href="#cb48-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-139"><a href="#cb48-139" aria-hidden="true" tabindex="-1"></a><span class="al">![png](output_13_2.png)</span></span>
<span id="cb48-140"><a href="#cb48-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-141"><a href="#cb48-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-142"><a href="#cb48-142" aria-hidden="true" tabindex="-1"></a><span class="fu">## Composite scoring</span></span>
<span id="cb48-143"><a href="#cb48-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-144"><a href="#cb48-144" aria-hidden="true" tabindex="-1"></a>First I'll standardize each of the test columns.</span>
<span id="cb48-145"><a href="#cb48-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-146"><a href="#cb48-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-147"><a href="#cb48-147" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb48-148"><a href="#cb48-148" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> zscore</span>
<span id="cb48-149"><a href="#cb48-149" aria-hidden="true" tabindex="-1"></a>df2[<span class="st">'DSST_z'</span>] <span class="op">=</span> df2[<span class="st">'CFDDS'</span>].pipe(zscore)</span>
<span id="cb48-150"><a href="#cb48-150" aria-hidden="true" tabindex="-1"></a>df2[<span class="st">'AFT_z'</span>] <span class="op">=</span> df2[<span class="st">'CFDAST'</span>].pipe(zscore)</span>
<span id="cb48-151"><a href="#cb48-151" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-152"><a href="#cb48-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-153"><a href="#cb48-153" aria-hidden="true" tabindex="-1"></a>Next, I'll create a composite by taking the average of the two standardized scores.</span>
<span id="cb48-154"><a href="#cb48-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-155"><a href="#cb48-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-156"><a href="#cb48-156" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb48-157"><a href="#cb48-157" aria-hidden="true" tabindex="-1"></a>df2[<span class="st">'COG'</span>] <span class="op">=</span> (df2[<span class="st">'DSST_z'</span>] <span class="op">+</span> df2[<span class="st">'AFT_z'</span>]) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb48-158"><a href="#cb48-158" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-159"><a href="#cb48-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-160"><a href="#cb48-160" aria-hidden="true" tabindex="-1"></a>Finally, I'll check to make sure that the distribution of composite scores is still normal.</span>
<span id="cb48-161"><a href="#cb48-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-162"><a href="#cb48-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-163"><a href="#cb48-163" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb48-164"><a href="#cb48-164" aria-hidden="true" tabindex="-1"></a>plt.hist(df2[<span class="st">'COG'</span>], bins<span class="op">=</span><span class="dv">35</span>)</span>
<span id="cb48-165"><a href="#cb48-165" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Composite Cognition"</span>)</span>
<span id="cb48-166"><a href="#cb48-166" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-167"><a href="#cb48-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-168"><a href="#cb48-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-169"><a href="#cb48-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-170"><a href="#cb48-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-171"><a href="#cb48-171" aria-hidden="true" tabindex="-1"></a><span class="in">    Text(0.5, 1.0, 'Composite Cognition')</span></span>
<span id="cb48-172"><a href="#cb48-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-173"><a href="#cb48-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-174"><a href="#cb48-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-175"><a href="#cb48-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-176"><a href="#cb48-176" aria-hidden="true" tabindex="-1"></a><span class="al">![png](output_20_1.png)</span></span>
<span id="cb48-177"><a href="#cb48-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-178"><a href="#cb48-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-179"><a href="#cb48-179" aria-hidden="true" tabindex="-1"></a><span class="fu">## What is "low" cognition? </span></span>
<span id="cb48-180"><a href="#cb48-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-181"><a href="#cb48-181" aria-hidden="true" tabindex="-1"></a>Since these are standardized scores, we can say that low cognition represents 1 standardized unit below the mean.</span>
<span id="cb48-182"><a href="#cb48-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-183"><a href="#cb48-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-184"><a href="#cb48-184" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb48-185"><a href="#cb48-185" aria-hidden="true" tabindex="-1"></a>plt.hist(df2[<span class="st">'COG'</span>], bins<span class="op">=</span><span class="dv">35</span>)</span>
<span id="cb48-186"><a href="#cb48-186" aria-hidden="true" tabindex="-1"></a>plt.axvline(x<span class="op">=-</span><span class="dv">1</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb48-187"><a href="#cb48-187" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Composite Cognition with Threshold"</span>)</span>
<span id="cb48-188"><a href="#cb48-188" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-189"><a href="#cb48-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-190"><a href="#cb48-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-191"><a href="#cb48-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-192"><a href="#cb48-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-193"><a href="#cb48-193" aria-hidden="true" tabindex="-1"></a><span class="in">    Text(0.5, 1.0, 'Composite Cognition with Threshold')</span></span>
<span id="cb48-194"><a href="#cb48-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-195"><a href="#cb48-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-196"><a href="#cb48-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-197"><a href="#cb48-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-198"><a href="#cb48-198" aria-hidden="true" tabindex="-1"></a><span class="al">![png](output_22_1.png)</span></span>
<span id="cb48-199"><a href="#cb48-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-200"><a href="#cb48-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-201"><a href="#cb48-201" aria-hidden="true" tabindex="-1"></a>I'll create a variable to track this classification.</span>
<span id="cb48-202"><a href="#cb48-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-203"><a href="#cb48-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-204"><a href="#cb48-204" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb48-205"><a href="#cb48-205" aria-hidden="true" tabindex="-1"></a>df2[<span class="st">'COG_low'</span>] <span class="op">=</span> df2[<span class="st">'COG'</span>] <span class="op">&lt;</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb48-206"><a href="#cb48-206" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-207"><a href="#cb48-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-208"><a href="#cb48-208" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model features</span></span>
<span id="cb48-209"><a href="#cb48-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-210"><a href="#cb48-210" aria-hidden="true" tabindex="-1"></a>I'll collect all the features that I think might be interesting.</span>
<span id="cb48-211"><a href="#cb48-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-212"><a href="#cb48-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-213"><a href="#cb48-213" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb48-214"><a href="#cb48-214" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> {<span class="co"># Composite cognition score</span></span>
<span id="cb48-215"><a href="#cb48-215" aria-hidden="true" tabindex="-1"></a>            <span class="st">'COG'</span>: <span class="st">'cognition'</span>,</span>
<span id="cb48-216"><a href="#cb48-216" aria-hidden="true" tabindex="-1"></a>            <span class="st">'COG_low'</span>: <span class="st">'cognition_impaired'</span>,</span>
<span id="cb48-217"><a href="#cb48-217" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-218"><a href="#cb48-218" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Demographics</span></span>
<span id="cb48-219"><a href="#cb48-219" aria-hidden="true" tabindex="-1"></a>            <span class="st">'RIAGENDR'</span>: <span class="st">'gender'</span>, </span>
<span id="cb48-220"><a href="#cb48-220" aria-hidden="true" tabindex="-1"></a>            <span class="st">'RIDAGEYR'</span>: <span class="st">'age'</span>,</span>
<span id="cb48-221"><a href="#cb48-221" aria-hidden="true" tabindex="-1"></a>            <span class="st">'RIDRETH1'</span>: <span class="st">'race'</span>,</span>
<span id="cb48-222"><a href="#cb48-222" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb48-223"><a href="#cb48-223" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Poverty level</span></span>
<span id="cb48-224"><a href="#cb48-224" aria-hidden="true" tabindex="-1"></a>            <span class="st">'INDFMMPI'</span>: <span class="st">'poverty'</span>,</span>
<span id="cb48-225"><a href="#cb48-225" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb48-226"><a href="#cb48-226" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Body mass index</span></span>
<span id="cb48-227"><a href="#cb48-227" aria-hidden="true" tabindex="-1"></a>            <span class="st">'BMXBMI'</span>: <span class="st">'bmi'</span>,</span>
<span id="cb48-228"><a href="#cb48-228" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb48-229"><a href="#cb48-229" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Alcohol use</span></span>
<span id="cb48-230"><a href="#cb48-230" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ALQ120Q'</span>: <span class="st">'alcohol_days'</span>,</span>
<span id="cb48-231"><a href="#cb48-231" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb48-232"><a href="#cb48-232" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Blood vitamin levels</span></span>
<span id="cb48-233"><a href="#cb48-233" aria-hidden="true" tabindex="-1"></a>            <span class="st">'LBXVIDMS'</span>: <span class="st">'vit_d'</span>,</span>
<span id="cb48-234"><a href="#cb48-234" aria-hidden="true" tabindex="-1"></a>            <span class="st">'LBDB12'</span>: <span class="st">'vit_b12'</span>,</span>
<span id="cb48-235"><a href="#cb48-235" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb48-236"><a href="#cb48-236" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Diet</span></span>
<span id="cb48-237"><a href="#cb48-237" aria-hidden="true" tabindex="-1"></a>            <span class="st">'DBQ700'</span>: <span class="st">'diet_healthy'</span>,</span>
<span id="cb48-238"><a href="#cb48-238" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb48-239"><a href="#cb48-239" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Lead</span></span>
<span id="cb48-240"><a href="#cb48-240" aria-hidden="true" tabindex="-1"></a>            <span class="st">'LBXBPB'</span>: <span class="st">'blood_lead'</span>,</span>
<span id="cb48-241"><a href="#cb48-241" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb48-242"><a href="#cb48-242" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Blood nicotine metabolite</span></span>
<span id="cb48-243"><a href="#cb48-243" aria-hidden="true" tabindex="-1"></a>            <span class="st">'LBXCOT'</span>: <span class="st">'cotinine'</span>,</span>
<span id="cb48-244"><a href="#cb48-244" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb48-245"><a href="#cb48-245" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Grip strength</span></span>
<span id="cb48-246"><a href="#cb48-246" aria-hidden="true" tabindex="-1"></a>            <span class="co"># https://wwwn.cdc.gov/Nchs/Nhanes/2013-2014/MGX_H.htm#MGDCGSZ</span></span>
<span id="cb48-247"><a href="#cb48-247" aria-hidden="true" tabindex="-1"></a>            <span class="st">'MGDCGSZ'</span>: <span class="st">'grip_strength'</span>,</span>
<span id="cb48-248"><a href="#cb48-248" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb48-249"><a href="#cb48-249" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Smell test</span></span>
<span id="cb48-250"><a href="#cb48-250" aria-hidden="true" tabindex="-1"></a>            <span class="st">'CSXCHOOD'</span>: <span class="st">'smell_choco'</span>,</span>
<span id="cb48-251"><a href="#cb48-251" aria-hidden="true" tabindex="-1"></a>            <span class="st">'CSXSBOD'</span>: <span class="st">'smell_strawberry'</span>,</span>
<span id="cb48-252"><a href="#cb48-252" aria-hidden="true" tabindex="-1"></a>            <span class="st">'CSXSMKOD'</span>: <span class="st">'smell_smoke'</span>,</span>
<span id="cb48-253"><a href="#cb48-253" aria-hidden="true" tabindex="-1"></a>            <span class="st">'CSXLEAOD'</span>: <span class="st">'smell_leather'</span>,</span>
<span id="cb48-254"><a href="#cb48-254" aria-hidden="true" tabindex="-1"></a>            <span class="st">'CSXSOAOD'</span>: <span class="st">'smell_soap'</span>,</span>
<span id="cb48-255"><a href="#cb48-255" aria-hidden="true" tabindex="-1"></a>            <span class="st">'CSXGRAOD'</span>: <span class="st">'smell_grape'</span>,</span>
<span id="cb48-256"><a href="#cb48-256" aria-hidden="true" tabindex="-1"></a>            <span class="st">'CSXONOD'</span>: <span class="st">'smell_onion'</span>,</span>
<span id="cb48-257"><a href="#cb48-257" aria-hidden="true" tabindex="-1"></a>            <span class="st">'CSXNGSOD'</span>: <span class="st">'smell_gas'</span>,</span>
<span id="cb48-258"><a href="#cb48-258" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb48-259"><a href="#cb48-259" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Health in general</span></span>
<span id="cb48-260"><a href="#cb48-260" aria-hidden="true" tabindex="-1"></a>            <span class="st">'HSD010'</span>: <span class="st">'health_general'</span>,</span>
<span id="cb48-261"><a href="#cb48-261" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb48-262"><a href="#cb48-262" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Depression screener</span></span>
<span id="cb48-263"><a href="#cb48-263" aria-hidden="true" tabindex="-1"></a>            <span class="st">'DPQ010'</span>: <span class="st">'dep_1'</span>,</span>
<span id="cb48-264"><a href="#cb48-264" aria-hidden="true" tabindex="-1"></a>            <span class="st">'DPQ020'</span>: <span class="st">'dep_2'</span>,</span>
<span id="cb48-265"><a href="#cb48-265" aria-hidden="true" tabindex="-1"></a>            <span class="st">'DPQ030'</span>: <span class="st">'dep_3'</span>,</span>
<span id="cb48-266"><a href="#cb48-266" aria-hidden="true" tabindex="-1"></a>            <span class="st">'DPQ040'</span>: <span class="st">'dep_4'</span>,</span>
<span id="cb48-267"><a href="#cb48-267" aria-hidden="true" tabindex="-1"></a>            <span class="st">'DPQ050'</span>: <span class="st">'dep_5'</span>,</span>
<span id="cb48-268"><a href="#cb48-268" aria-hidden="true" tabindex="-1"></a>            <span class="st">'DPQ060'</span>: <span class="st">'dep_6'</span>,</span>
<span id="cb48-269"><a href="#cb48-269" aria-hidden="true" tabindex="-1"></a>            <span class="st">'DPQ070'</span>: <span class="st">'dep_7'</span>,</span>
<span id="cb48-270"><a href="#cb48-270" aria-hidden="true" tabindex="-1"></a>            <span class="st">'DPQ080'</span>: <span class="st">'dep_8'</span>,</span>
<span id="cb48-271"><a href="#cb48-271" aria-hidden="true" tabindex="-1"></a>            <span class="st">'DPQ090'</span>: <span class="st">'dep_9'</span>,</span>
<span id="cb48-272"><a href="#cb48-272" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb48-273"><a href="#cb48-273" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Sleep</span></span>
<span id="cb48-274"><a href="#cb48-274" aria-hidden="true" tabindex="-1"></a>            <span class="st">'SLD010H'</span>: <span class="st">'sleep'</span>,</span>
<span id="cb48-275"><a href="#cb48-275" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb48-276"><a href="#cb48-276" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Heart rate</span></span>
<span id="cb48-277"><a href="#cb48-277" aria-hidden="true" tabindex="-1"></a>            <span class="st">'BPXPLS'</span>: <span class="st">'heart_rate'</span></span>
<span id="cb48-278"><a href="#cb48-278" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb48-279"><a href="#cb48-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-280"><a href="#cb48-280" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> df2.loc[:, <span class="bu">list</span>(features)]</span>
<span id="cb48-281"><a href="#cb48-281" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> df2.rename(columns<span class="op">=</span>features)</span>
<span id="cb48-282"><a href="#cb48-282" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-283"><a href="#cb48-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-284"><a href="#cb48-284" aria-hidden="true" tabindex="-1"></a><span class="fu">### Recoding variables</span></span>
<span id="cb48-285"><a href="#cb48-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-286"><a href="#cb48-286" aria-hidden="true" tabindex="-1"></a>Some of the features need to be combined. For example, the smell tests can all be combined into a single "smell test" score; the depression scale can be converted into a single depression score.</span>
<span id="cb48-287"><a href="#cb48-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-288"><a href="#cb48-288" aria-hidden="true" tabindex="-1"></a>On some features the values are numeric but not ordinal. For example, on the depression scale scores 0-3 represent increasing levels of depression symptom severity, but a score of "9" means "don't know" and a score of "7" means "refused". This will be important to catch in the variable coding.</span>
<span id="cb48-289"><a href="#cb48-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-290"><a href="#cb48-290" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Depression items</span></span>
<span id="cb48-291"><a href="#cb48-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-292"><a href="#cb48-292" aria-hidden="true" tabindex="-1"></a>First I'll score the depression items. I'll take the mean of all the items responded to.</span>
<span id="cb48-293"><a href="#cb48-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-294"><a href="#cb48-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-295"><a href="#cb48-295" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb48-296"><a href="#cb48-296" aria-hidden="true" tabindex="-1"></a>items <span class="op">=</span> [<span class="st">'dep_1'</span>, <span class="st">'dep_2'</span>, <span class="st">'dep_3'</span>, <span class="st">'dep_4'</span>,</span>
<span id="cb48-297"><a href="#cb48-297" aria-hidden="true" tabindex="-1"></a>        <span class="st">'dep_5'</span>, <span class="st">'dep_6'</span>, <span class="st">'dep_7'</span>, <span class="st">'dep_8'</span>,</span>
<span id="cb48-298"><a href="#cb48-298" aria-hidden="true" tabindex="-1"></a>        <span class="st">'dep_9'</span>]</span>
<span id="cb48-299"><a href="#cb48-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-300"><a href="#cb48-300" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> score_depression(x):</span>
<span id="cb48-301"><a href="#cb48-301" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-302"><a href="#cb48-302" aria-hidden="true" tabindex="-1"></a>    scores <span class="op">=</span> []</span>
<span id="cb48-303"><a href="#cb48-303" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-304"><a href="#cb48-304" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> item <span class="kw">in</span> items:</span>
<span id="cb48-305"><a href="#cb48-305" aria-hidden="true" tabindex="-1"></a>        value <span class="op">=</span> x[item]</span>
<span id="cb48-306"><a href="#cb48-306" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> value <span class="op">&lt;</span> <span class="dv">4</span>:</span>
<span id="cb48-307"><a href="#cb48-307" aria-hidden="true" tabindex="-1"></a>            scores.append(value)</span>
<span id="cb48-308"><a href="#cb48-308" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-309"><a href="#cb48-309" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(scores) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb48-310"><a href="#cb48-310" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb48-311"><a href="#cb48-311" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb48-312"><a href="#cb48-312" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.mean(scores)</span>
<span id="cb48-313"><a href="#cb48-313" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-314"><a href="#cb48-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-315"><a href="#cb48-315" aria-hidden="true" tabindex="-1"></a>df2.loc[:, <span class="st">'dep_tot'</span>] <span class="op">=</span> df2.<span class="bu">apply</span>(score_depression, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb48-316"><a href="#cb48-316" aria-hidden="true" tabindex="-1"></a>df2.drop(items, axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb48-317"><a href="#cb48-317" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-318"><a href="#cb48-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-319"><a href="#cb48-319" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Smell test</span></span>
<span id="cb48-320"><a href="#cb48-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-321"><a href="#cb48-321" aria-hidden="true" tabindex="-1"></a>Next, I'll score the smell test items. Each item has one correct response and several incorrect responses. I'll take the mean number of correct responses.</span>
<span id="cb48-322"><a href="#cb48-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-323"><a href="#cb48-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-324"><a href="#cb48-324" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb48-325"><a href="#cb48-325" aria-hidden="true" tabindex="-1"></a>items <span class="op">=</span> [<span class="st">'smell_choco'</span>, <span class="st">'smell_strawberry'</span>,</span>
<span id="cb48-326"><a href="#cb48-326" aria-hidden="true" tabindex="-1"></a>         <span class="st">'smell_smoke'</span>, <span class="st">'smell_leather'</span>,</span>
<span id="cb48-327"><a href="#cb48-327" aria-hidden="true" tabindex="-1"></a>         <span class="st">'smell_soap'</span>, <span class="st">'smell_grape'</span>,</span>
<span id="cb48-328"><a href="#cb48-328" aria-hidden="true" tabindex="-1"></a>         <span class="st">'smell_onion'</span>, <span class="st">'smell_gas'</span>]</span>
<span id="cb48-329"><a href="#cb48-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-330"><a href="#cb48-330" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> score_smell(x):</span>
<span id="cb48-331"><a href="#cb48-331" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-332"><a href="#cb48-332" aria-hidden="true" tabindex="-1"></a>    scores <span class="op">=</span> []</span>
<span id="cb48-333"><a href="#cb48-333" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-334"><a href="#cb48-334" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x[<span class="st">'smell_choco'</span>] <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb48-335"><a href="#cb48-335" aria-hidden="true" tabindex="-1"></a>        scores.append(<span class="dv">1</span>)</span>
<span id="cb48-336"><a href="#cb48-336" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="op">~</span>np.isnan(x[<span class="st">'smell_choco'</span>]):</span>
<span id="cb48-337"><a href="#cb48-337" aria-hidden="true" tabindex="-1"></a>        scores.append(<span class="dv">0</span>)</span>
<span id="cb48-338"><a href="#cb48-338" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb48-339"><a href="#cb48-339" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x[<span class="st">'smell_strawberry'</span>] <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb48-340"><a href="#cb48-340" aria-hidden="true" tabindex="-1"></a>        scores.append(<span class="dv">1</span>)</span>
<span id="cb48-341"><a href="#cb48-341" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="op">~</span>np.isnan(x[<span class="st">'smell_strawberry'</span>]):</span>
<span id="cb48-342"><a href="#cb48-342" aria-hidden="true" tabindex="-1"></a>        scores.append(<span class="dv">0</span>)</span>
<span id="cb48-343"><a href="#cb48-343" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb48-344"><a href="#cb48-344" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x[<span class="st">'smell_smoke'</span>] <span class="op">==</span> <span class="dv">3</span>:</span>
<span id="cb48-345"><a href="#cb48-345" aria-hidden="true" tabindex="-1"></a>        scores.append(<span class="dv">1</span>)</span>
<span id="cb48-346"><a href="#cb48-346" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="op">~</span>np.isnan(x[<span class="st">'smell_smoke'</span>]):</span>
<span id="cb48-347"><a href="#cb48-347" aria-hidden="true" tabindex="-1"></a>        scores.append(<span class="dv">0</span>)</span>
<span id="cb48-348"><a href="#cb48-348" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb48-349"><a href="#cb48-349" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x[<span class="st">'smell_leather'</span>] <span class="op">==</span> <span class="dv">3</span>:</span>
<span id="cb48-350"><a href="#cb48-350" aria-hidden="true" tabindex="-1"></a>        scores.append(<span class="dv">1</span>)</span>
<span id="cb48-351"><a href="#cb48-351" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="op">~</span>np.isnan(x[<span class="st">'smell_leather'</span>]):</span>
<span id="cb48-352"><a href="#cb48-352" aria-hidden="true" tabindex="-1"></a>        scores.append(<span class="dv">0</span>)</span>
<span id="cb48-353"><a href="#cb48-353" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb48-354"><a href="#cb48-354" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x[<span class="st">'smell_soap'</span>] <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb48-355"><a href="#cb48-355" aria-hidden="true" tabindex="-1"></a>        scores.append(<span class="dv">1</span>)</span>
<span id="cb48-356"><a href="#cb48-356" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="op">~</span>np.isnan(x[<span class="st">'smell_soap'</span>]):</span>
<span id="cb48-357"><a href="#cb48-357" aria-hidden="true" tabindex="-1"></a>        scores.append(<span class="dv">0</span>)</span>
<span id="cb48-358"><a href="#cb48-358" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb48-359"><a href="#cb48-359" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x[<span class="st">'smell_grape'</span>] <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb48-360"><a href="#cb48-360" aria-hidden="true" tabindex="-1"></a>        scores.append(<span class="dv">1</span>)</span>
<span id="cb48-361"><a href="#cb48-361" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="op">~</span>np.isnan(x[<span class="st">'smell_grape'</span>]):</span>
<span id="cb48-362"><a href="#cb48-362" aria-hidden="true" tabindex="-1"></a>        scores.append(<span class="dv">0</span>)</span>
<span id="cb48-363"><a href="#cb48-363" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb48-364"><a href="#cb48-364" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x[<span class="st">'smell_onion'</span>] <span class="op">==</span> <span class="dv">3</span>:</span>
<span id="cb48-365"><a href="#cb48-365" aria-hidden="true" tabindex="-1"></a>        scores.append(<span class="dv">1</span>)</span>
<span id="cb48-366"><a href="#cb48-366" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="op">~</span>np.isnan(x[<span class="st">'smell_onion'</span>]):</span>
<span id="cb48-367"><a href="#cb48-367" aria-hidden="true" tabindex="-1"></a>        scores.append(<span class="dv">0</span>)</span>
<span id="cb48-368"><a href="#cb48-368" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb48-369"><a href="#cb48-369" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x[<span class="st">'smell_gas'</span>] <span class="op">==</span> <span class="dv">4</span>:</span>
<span id="cb48-370"><a href="#cb48-370" aria-hidden="true" tabindex="-1"></a>        scores.append(<span class="dv">1</span>)</span>
<span id="cb48-371"><a href="#cb48-371" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="op">~</span>np.isnan(x[<span class="st">'smell_gas'</span>]):</span>
<span id="cb48-372"><a href="#cb48-372" aria-hidden="true" tabindex="-1"></a>        scores.append(<span class="dv">0</span>)</span>
<span id="cb48-373"><a href="#cb48-373" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-374"><a href="#cb48-374" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(scores) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb48-375"><a href="#cb48-375" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb48-376"><a href="#cb48-376" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb48-377"><a href="#cb48-377" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.nanmean(scores)</span>
<span id="cb48-378"><a href="#cb48-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-379"><a href="#cb48-379" aria-hidden="true" tabindex="-1"></a>df2.loc[:, <span class="st">'smell_tot'</span>] <span class="op">=</span> df2.<span class="bu">apply</span>(score_smell, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb48-380"><a href="#cb48-380" aria-hidden="true" tabindex="-1"></a>df2.drop(items, axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb48-381"><a href="#cb48-381" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-382"><a href="#cb48-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-383"><a href="#cb48-383" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Others</span></span>
<span id="cb48-384"><a href="#cb48-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-385"><a href="#cb48-385" aria-hidden="true" tabindex="-1"></a>Replace "Don't know" and "Refused" with missing.</span>
<span id="cb48-386"><a href="#cb48-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-387"><a href="#cb48-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-388"><a href="#cb48-388" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb48-389"><a href="#cb48-389" aria-hidden="true" tabindex="-1"></a>df2[<span class="st">'health_general'</span>].replace([<span class="fl">9.0</span>, <span class="fl">7.0</span>], [np.nan, np.nan], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb48-390"><a href="#cb48-390" aria-hidden="true" tabindex="-1"></a>df2[<span class="st">'sleep'</span>].replace([<span class="fl">99.0</span>, <span class="fl">77.0</span>], [np.nan, np.nan], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb48-391"><a href="#cb48-391" aria-hidden="true" tabindex="-1"></a>df2[<span class="st">'alcohol_days'</span>].replace([<span class="fl">999.0</span>, <span class="fl">777.0</span>], [np.nan, np.nan], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb48-392"><a href="#cb48-392" aria-hidden="true" tabindex="-1"></a>df2[<span class="st">'diet_healthy'</span>].replace([<span class="fl">9.0</span>, <span class="fl">7.0</span>], [np.nan, np.nan], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb48-393"><a href="#cb48-393" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-394"><a href="#cb48-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-395"><a href="#cb48-395" aria-hidden="true" tabindex="-1"></a><span class="fu">### Missing values</span></span>
<span id="cb48-396"><a href="#cb48-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-397"><a href="#cb48-397" aria-hidden="true" tabindex="-1"></a>How many values are missing in each column?</span>
<span id="cb48-398"><a href="#cb48-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-399"><a href="#cb48-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-400"><a href="#cb48-400" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb48-401"><a href="#cb48-401" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'% missing values'</span>)</span>
<span id="cb48-402"><a href="#cb48-402" aria-hidden="true" tabindex="-1"></a><span class="bu">round</span>(df2.isnull().<span class="bu">sum</span>() <span class="op">/</span> <span class="bu">len</span>(df2) <span class="op">*</span> <span class="dv">100</span>)</span>
<span id="cb48-403"><a href="#cb48-403" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-404"><a href="#cb48-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-405"><a href="#cb48-405" aria-hidden="true" tabindex="-1"></a><span class="in">    % missing values</span></span>
<span id="cb48-406"><a href="#cb48-406" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb48-407"><a href="#cb48-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-408"><a href="#cb48-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-409"><a href="#cb48-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-410"><a href="#cb48-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-411"><a href="#cb48-411" aria-hidden="true" tabindex="-1"></a><span class="in">    cognition              0.0</span></span>
<span id="cb48-412"><a href="#cb48-412" aria-hidden="true" tabindex="-1"></a><span class="in">    cognition_impaired     0.0</span></span>
<span id="cb48-413"><a href="#cb48-413" aria-hidden="true" tabindex="-1"></a><span class="in">    gender                 0.0</span></span>
<span id="cb48-414"><a href="#cb48-414" aria-hidden="true" tabindex="-1"></a><span class="in">    age                    0.0</span></span>
<span id="cb48-415"><a href="#cb48-415" aria-hidden="true" tabindex="-1"></a><span class="in">    race                   0.0</span></span>
<span id="cb48-416"><a href="#cb48-416" aria-hidden="true" tabindex="-1"></a><span class="in">    poverty               11.0</span></span>
<span id="cb48-417"><a href="#cb48-417" aria-hidden="true" tabindex="-1"></a><span class="in">    bmi                    1.0</span></span>
<span id="cb48-418"><a href="#cb48-418" aria-hidden="true" tabindex="-1"></a><span class="in">    alcohol_days          18.0</span></span>
<span id="cb48-419"><a href="#cb48-419" aria-hidden="true" tabindex="-1"></a><span class="in">    vit_d                  3.0</span></span>
<span id="cb48-420"><a href="#cb48-420" aria-hidden="true" tabindex="-1"></a><span class="in">    vit_b12                4.0</span></span>
<span id="cb48-421"><a href="#cb48-421" aria-hidden="true" tabindex="-1"></a><span class="in">    diet_healthy           0.0</span></span>
<span id="cb48-422"><a href="#cb48-422" aria-hidden="true" tabindex="-1"></a><span class="in">    blood_lead            51.0</span></span>
<span id="cb48-423"><a href="#cb48-423" aria-hidden="true" tabindex="-1"></a><span class="in">    cotinine               4.0</span></span>
<span id="cb48-424"><a href="#cb48-424" aria-hidden="true" tabindex="-1"></a><span class="in">    grip_strength         11.0</span></span>
<span id="cb48-425"><a href="#cb48-425" aria-hidden="true" tabindex="-1"></a><span class="in">    health_general         2.0</span></span>
<span id="cb48-426"><a href="#cb48-426" aria-hidden="true" tabindex="-1"></a><span class="in">    sleep                  0.0</span></span>
<span id="cb48-427"><a href="#cb48-427" aria-hidden="true" tabindex="-1"></a><span class="in">    heart_rate             3.0</span></span>
<span id="cb48-428"><a href="#cb48-428" aria-hidden="true" tabindex="-1"></a><span class="in">    dep_tot                2.0</span></span>
<span id="cb48-429"><a href="#cb48-429" aria-hidden="true" tabindex="-1"></a><span class="in">    smell_tot              3.0</span></span>
<span id="cb48-430"><a href="#cb48-430" aria-hidden="true" tabindex="-1"></a><span class="in">    dtype: float64</span></span>
<span id="cb48-431"><a href="#cb48-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-432"><a href="#cb48-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-433"><a href="#cb48-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-434"><a href="#cb48-434" aria-hidden="true" tabindex="-1"></a><span class="fu"># Preprocessing</span></span>
<span id="cb48-435"><a href="#cb48-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-436"><a href="#cb48-436" aria-hidden="true" tabindex="-1"></a>I will use median imputation for missing numeric values.</span>
<span id="cb48-437"><a href="#cb48-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-438"><a href="#cb48-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-439"><a href="#cb48-439" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb48-440"><a href="#cb48-440" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> ColumnTransformer</span>
<span id="cb48-441"><a href="#cb48-441" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> LabelEncoder, OneHotEncoder</span>
<span id="cb48-442"><a href="#cb48-442" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.impute <span class="im">import</span> SimpleImputer</span>
<span id="cb48-443"><a href="#cb48-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-444"><a href="#cb48-444" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df2.drop([<span class="st">'cognition'</span>, <span class="st">'cognition_impaired'</span>], axis<span class="op">=</span><span class="dv">1</span>) <span class="co"># Features</span></span>
<span id="cb48-445"><a href="#cb48-445" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df2[<span class="st">'cognition'</span>] <span class="co"># Outcome raw</span></span>
<span id="cb48-446"><a href="#cb48-446" aria-hidden="true" tabindex="-1"></a>y2 <span class="op">=</span> df2[<span class="st">'cognition_impaired'</span>] <span class="co"># Outcome binary</span></span>
<span id="cb48-447"><a href="#cb48-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-448"><a href="#cb48-448" aria-hidden="true" tabindex="-1"></a>ct <span class="op">=</span> ColumnTransformer(</span>
<span id="cb48-449"><a href="#cb48-449" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb48-450"><a href="#cb48-450" aria-hidden="true" tabindex="-1"></a>        <span class="co">#('ohe', OneHotEncoder(sparse=False, handle_unknown='ignore'), [1, 3]),</span></span>
<span id="cb48-451"><a href="#cb48-451" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'impute'</span>, SimpleImputer(strategy<span class="op">=</span><span class="st">'median'</span>), [<span class="dv">0</span>, <span class="op">-</span><span class="dv">2</span>]),</span>
<span id="cb48-452"><a href="#cb48-452" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb48-453"><a href="#cb48-453" aria-hidden="true" tabindex="-1"></a>    remainder<span class="op">=</span><span class="st">'passthrough'</span></span>
<span id="cb48-454"><a href="#cb48-454" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-455"><a href="#cb48-455" aria-hidden="true" tabindex="-1"></a>X_arr <span class="op">=</span> ct.fit_transform(X)</span>
<span id="cb48-456"><a href="#cb48-456" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-457"><a href="#cb48-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-458"><a href="#cb48-458" aria-hidden="true" tabindex="-1"></a><span class="fu"># XGBoost model</span></span>
<span id="cb48-459"><a href="#cb48-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-460"><a href="#cb48-460" aria-hidden="true" tabindex="-1"></a>Next I'll train a model to predict the composite cognition score using xgboost.</span>
<span id="cb48-461"><a href="#cb48-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-462"><a href="#cb48-462" aria-hidden="true" tabindex="-1"></a>I'll stratify the train-test split on the classification of healthy/impaired cognition.</span>
<span id="cb48-463"><a href="#cb48-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-464"><a href="#cb48-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-465"><a href="#cb48-465" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb48-466"><a href="#cb48-466" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> xgboost <span class="im">import</span> XGBRegressor, XGBClassifier</span>
<span id="cb48-467"><a href="#cb48-467" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> xgboost <span class="im">import</span> plot_importance</span>
<span id="cb48-468"><a href="#cb48-468" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split, RandomizedSearchCV</span>
<span id="cb48-469"><a href="#cb48-469" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, precision_score, recall_score, roc_curve, roc_auc_score, plot_roc_curve, confusion_matrix</span>
<span id="cb48-470"><a href="#cb48-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-471"><a href="#cb48-471" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X_arr, y2, </span>
<span id="cb48-472"><a href="#cb48-472" aria-hidden="true" tabindex="-1"></a>                                                    test_size<span class="op">=</span><span class="fl">0.2</span>, </span>
<span id="cb48-473"><a href="#cb48-473" aria-hidden="true" tabindex="-1"></a>                                                    random_state<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb48-474"><a href="#cb48-474" aria-hidden="true" tabindex="-1"></a>                                                    stratify<span class="op">=</span>y2)</span>
<span id="cb48-475"><a href="#cb48-475" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-476"><a href="#cb48-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-477"><a href="#cb48-477" aria-hidden="true" tabindex="-1"></a><span class="fu">## Baseline model</span></span>
<span id="cb48-478"><a href="#cb48-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-479"><a href="#cb48-479" aria-hidden="true" tabindex="-1"></a>I'll train a baseline xgboost model, without any parameter tuning. This will give me a general sense of the model's performance.</span>
<span id="cb48-480"><a href="#cb48-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-481"><a href="#cb48-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-482"><a href="#cb48-482" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb48-483"><a href="#cb48-483" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> XGBClassifier()</span>
<span id="cb48-484"><a href="#cb48-484" aria-hidden="true" tabindex="-1"></a>model.fit(X_train, y_train)</span>
<span id="cb48-485"><a href="#cb48-485" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-486"><a href="#cb48-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-487"><a href="#cb48-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-488"><a href="#cb48-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-489"><a href="#cb48-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-490"><a href="#cb48-490" aria-hidden="true" tabindex="-1"></a><span class="in">    XGBClassifier(base_score=0.5, booster=None, colsample_bylevel=1,</span></span>
<span id="cb48-491"><a href="#cb48-491" aria-hidden="true" tabindex="-1"></a><span class="in">                  colsample_bynode=1, colsample_bytree=1, gamma=0, gpu_id=-1,</span></span>
<span id="cb48-492"><a href="#cb48-492" aria-hidden="true" tabindex="-1"></a><span class="in">                  importance_type='gain', interaction_constraints=None,</span></span>
<span id="cb48-493"><a href="#cb48-493" aria-hidden="true" tabindex="-1"></a><span class="in">                  learning_rate=0.300000012, max_delta_step=0, max_depth=6,</span></span>
<span id="cb48-494"><a href="#cb48-494" aria-hidden="true" tabindex="-1"></a><span class="in">                  min_child_weight=1, missing=nan, monotone_constraints=None,</span></span>
<span id="cb48-495"><a href="#cb48-495" aria-hidden="true" tabindex="-1"></a><span class="in">                  n_estimators=100, n_jobs=0, num_parallel_tree=1,</span></span>
<span id="cb48-496"><a href="#cb48-496" aria-hidden="true" tabindex="-1"></a><span class="in">                  objective='binary:logistic', random_state=0, reg_alpha=0,</span></span>
<span id="cb48-497"><a href="#cb48-497" aria-hidden="true" tabindex="-1"></a><span class="in">                  reg_lambda=1, scale_pos_weight=1, subsample=1, tree_method=None,</span></span>
<span id="cb48-498"><a href="#cb48-498" aria-hidden="true" tabindex="-1"></a><span class="in">                  validate_parameters=False, verbosity=None)</span></span>
<span id="cb48-499"><a href="#cb48-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-500"><a href="#cb48-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-501"><a href="#cb48-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-502"><a href="#cb48-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-503"><a href="#cb48-503" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb48-504"><a href="#cb48-504" aria-hidden="true" tabindex="-1"></a>model.score(X_test, y_test)</span>
<span id="cb48-505"><a href="#cb48-505" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-506"><a href="#cb48-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-507"><a href="#cb48-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-508"><a href="#cb48-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-509"><a href="#cb48-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-510"><a href="#cb48-510" aria-hidden="true" tabindex="-1"></a><span class="in">    0.8571428571428571</span></span>
<span id="cb48-511"><a href="#cb48-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-512"><a href="#cb48-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-513"><a href="#cb48-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-514"><a href="#cb48-514" aria-hidden="true" tabindex="-1"></a><span class="fu">### Test performance</span></span>
<span id="cb48-515"><a href="#cb48-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-516"><a href="#cb48-516" aria-hidden="true" tabindex="-1"></a>How did the model perform on the test set?</span>
<span id="cb48-517"><a href="#cb48-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-518"><a href="#cb48-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-519"><a href="#cb48-519" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb48-520"><a href="#cb48-520" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> model.predict(X_test)</span>
<span id="cb48-521"><a href="#cb48-521" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Accuracy: </span><span class="sc">%.2f%%</span><span class="st">"</span> <span class="op">%</span> (accuracy_score(y_test, preds) <span class="op">*</span> <span class="fl">100.0</span>))</span>
<span id="cb48-522"><a href="#cb48-522" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Precision: </span><span class="sc">%.2f%%</span><span class="st">"</span> <span class="op">%</span> (precision_score(y_test, preds) <span class="op">*</span> <span class="fl">100.0</span>))</span>
<span id="cb48-523"><a href="#cb48-523" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Recall: </span><span class="sc">%.2f%%</span><span class="st">"</span> <span class="op">%</span> (recall_score(y_test, preds) <span class="op">*</span> <span class="fl">100.0</span>))</span>
<span id="cb48-524"><a href="#cb48-524" aria-hidden="true" tabindex="-1"></a>plot_roc_curve(model, X_test, y_test)</span>
<span id="cb48-525"><a href="#cb48-525" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-526"><a href="#cb48-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-527"><a href="#cb48-527" aria-hidden="true" tabindex="-1"></a><span class="in">    Accuracy: 85.71%</span></span>
<span id="cb48-528"><a href="#cb48-528" aria-hidden="true" tabindex="-1"></a><span class="in">    Precision: 40.91%</span></span>
<span id="cb48-529"><a href="#cb48-529" aria-hidden="true" tabindex="-1"></a><span class="in">    Recall: 21.95%</span></span>
<span id="cb48-530"><a href="#cb48-530" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb48-531"><a href="#cb48-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-532"><a href="#cb48-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-533"><a href="#cb48-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-534"><a href="#cb48-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-535"><a href="#cb48-535" aria-hidden="true" tabindex="-1"></a><span class="in">    &lt;sklearn.metrics._plot.roc_curve.RocCurveDisplay at 0x25115f7c7c8&gt;</span></span>
<span id="cb48-536"><a href="#cb48-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-537"><a href="#cb48-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-538"><a href="#cb48-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-539"><a href="#cb48-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-540"><a href="#cb48-540" aria-hidden="true" tabindex="-1"></a><span class="al">![png](output_45_2.png)</span></span>
<span id="cb48-541"><a href="#cb48-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-542"><a href="#cb48-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-543"><a href="#cb48-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-544"><a href="#cb48-544" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb48-545"><a href="#cb48-545" aria-hidden="true" tabindex="-1"></a>tn, fp, fn, tp <span class="op">=</span> confusion_matrix(y_test, preds).ravel()</span>
<span id="cb48-546"><a href="#cb48-546" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"True Pos: </span><span class="sc">{</span>tp<span class="sc">}</span><span class="ss">"</span> , <span class="ss">f"</span><span class="ch">\n</span><span class="ss">False Neg: </span><span class="sc">{</span>fn<span class="sc">}</span><span class="ss">"</span>, <span class="ss">f"</span><span class="ch">\n</span><span class="ss">False Pos: </span><span class="sc">{</span>fp<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb48-547"><a href="#cb48-547" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-548"><a href="#cb48-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-549"><a href="#cb48-549" aria-hidden="true" tabindex="-1"></a><span class="in">    True Pos: 9 </span></span>
<span id="cb48-550"><a href="#cb48-550" aria-hidden="true" tabindex="-1"></a><span class="in">    False Neg: 32 </span></span>
<span id="cb48-551"><a href="#cb48-551" aria-hidden="true" tabindex="-1"></a><span class="in">    False Pos: 13</span></span>
<span id="cb48-552"><a href="#cb48-552" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb48-553"><a href="#cb48-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-554"><a href="#cb48-554" aria-hidden="true" tabindex="-1"></a><span class="fu">## Biasing the model towards specificity</span></span>
<span id="cb48-555"><a href="#cb48-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-556"><a href="#cb48-556" aria-hidden="true" tabindex="-1"></a>The model didn't perform very well on specificity (a.k.a. recall), meaning that among the 41 individuals with cognitive impairment, the model was only able to correctly identify 22% of them.</span>
<span id="cb48-557"><a href="#cb48-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-558"><a href="#cb48-558" aria-hidden="true" tabindex="-1"></a>Let's imagine a scenario in which we might want to bias the model towards high specificity:</span>
<span id="cb48-559"><a href="#cb48-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-560"><a href="#cb48-560" aria-hidden="true" tabindex="-1"></a>Imagine the model is will be used to identify possible cases of dementia and when the model identifies a case of dementia they will be invited back for further testing to make a diagnosis with much higher precision. In this case, false positives would arguably carry a low risk because (let's say for the sake of argument) further testing will be harmless and individuals who are healthy will be discovered as healthy. On the other side of the equation, let's say that there is a high risk of negative consequences for anyone cases of dementia that go missed (and therefore untreated).</span>
<span id="cb48-561"><a href="#cb48-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-562"><a href="#cb48-562" aria-hidden="true" tabindex="-1"></a>This is a case where we would want to optimize for detecting cases of dementia at risk of having an inflated false-positive rate.</span>
<span id="cb48-563"><a href="#cb48-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-564"><a href="#cb48-564" aria-hidden="true" tabindex="-1"></a>Now, one of the reasons for poor recall performance was the imbalanced classes used to train the data. That is to say, the impaired class had many fewer examples than the healthy class. I can correct for this using a weighting parameter when I instantiate the model, setting it to the ratio of healthy-to-impaired examples.</span>
<span id="cb48-565"><a href="#cb48-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-566"><a href="#cb48-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-567"><a href="#cb48-567" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb48-568"><a href="#cb48-568" aria-hidden="true" tabindex="-1"></a>impaired <span class="op">=</span> <span class="bu">len</span>(df2[df2[<span class="st">'cognition_impaired'</span>] <span class="op">==</span> <span class="va">True</span>])</span>
<span id="cb48-569"><a href="#cb48-569" aria-hidden="true" tabindex="-1"></a>healthy <span class="op">=</span> <span class="bu">len</span>(df2[df2[<span class="st">'cognition_impaired'</span>] <span class="op">==</span> <span class="va">False</span>])</span>
<span id="cb48-570"><a href="#cb48-570" aria-hidden="true" tabindex="-1"></a>imbalance_ratio <span class="op">=</span> healthy <span class="op">/</span> impaired</span>
<span id="cb48-571"><a href="#cb48-571" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(imbalance_ratio)</span>
<span id="cb48-572"><a href="#cb48-572" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-573"><a href="#cb48-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-574"><a href="#cb48-574" aria-hidden="true" tabindex="-1"></a><span class="in">    6.720588235294118</span></span>
<span id="cb48-575"><a href="#cb48-575" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb48-576"><a href="#cb48-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-577"><a href="#cb48-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-578"><a href="#cb48-578" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb48-579"><a href="#cb48-579" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> XGBClassifier(scale_pos_weight <span class="op">=</span> imbalance_ratio)</span>
<span id="cb48-580"><a href="#cb48-580" aria-hidden="true" tabindex="-1"></a>model.fit(X_train, y_train)</span>
<span id="cb48-581"><a href="#cb48-581" aria-hidden="true" tabindex="-1"></a>model.score(X_test, y_test)</span>
<span id="cb48-582"><a href="#cb48-582" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-583"><a href="#cb48-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-584"><a href="#cb48-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-585"><a href="#cb48-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-586"><a href="#cb48-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-587"><a href="#cb48-587" aria-hidden="true" tabindex="-1"></a><span class="in">    0.8444444444444444</span></span>
<span id="cb48-588"><a href="#cb48-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-589"><a href="#cb48-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-590"><a href="#cb48-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-591"><a href="#cb48-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-592"><a href="#cb48-592" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb48-593"><a href="#cb48-593" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> model.predict(X_test)</span>
<span id="cb48-594"><a href="#cb48-594" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Accuracy: </span><span class="sc">%.2f%%</span><span class="st">"</span> <span class="op">%</span> (accuracy_score(y_test, preds) <span class="op">*</span> <span class="fl">100.0</span>))</span>
<span id="cb48-595"><a href="#cb48-595" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Precision: </span><span class="sc">%.2f%%</span><span class="st">"</span> <span class="op">%</span> (precision_score(y_test, preds) <span class="op">*</span> <span class="fl">100.0</span>))</span>
<span id="cb48-596"><a href="#cb48-596" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Recall: </span><span class="sc">%.2f%%</span><span class="st">"</span> <span class="op">%</span> (recall_score(y_test, preds) <span class="op">*</span> <span class="fl">100.0</span>))</span>
<span id="cb48-597"><a href="#cb48-597" aria-hidden="true" tabindex="-1"></a>plot_roc_curve(model, X_test, y_test)</span>
<span id="cb48-598"><a href="#cb48-598" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-599"><a href="#cb48-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-600"><a href="#cb48-600" aria-hidden="true" tabindex="-1"></a><span class="in">    Accuracy: 84.44%</span></span>
<span id="cb48-601"><a href="#cb48-601" aria-hidden="true" tabindex="-1"></a><span class="in">    Precision: 39.47%</span></span>
<span id="cb48-602"><a href="#cb48-602" aria-hidden="true" tabindex="-1"></a><span class="in">    Recall: 36.59%</span></span>
<span id="cb48-603"><a href="#cb48-603" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb48-604"><a href="#cb48-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-605"><a href="#cb48-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-606"><a href="#cb48-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-607"><a href="#cb48-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-608"><a href="#cb48-608" aria-hidden="true" tabindex="-1"></a><span class="in">    &lt;sklearn.metrics._plot.roc_curve.RocCurveDisplay at 0x25116152d08&gt;</span></span>
<span id="cb48-609"><a href="#cb48-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-610"><a href="#cb48-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-611"><a href="#cb48-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-612"><a href="#cb48-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-613"><a href="#cb48-613" aria-hidden="true" tabindex="-1"></a><span class="al">![png](output_50_2.png)</span></span>
<span id="cb48-614"><a href="#cb48-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-615"><a href="#cb48-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-616"><a href="#cb48-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-617"><a href="#cb48-617" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb48-618"><a href="#cb48-618" aria-hidden="true" tabindex="-1"></a>tn, fp, fn, tp <span class="op">=</span> confusion_matrix(y_test, preds).ravel()</span>
<span id="cb48-619"><a href="#cb48-619" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"True Pos: </span><span class="sc">{</span>tp<span class="sc">}</span><span class="ss">"</span> , <span class="ss">f"</span><span class="ch">\n</span><span class="ss">False Neg: </span><span class="sc">{</span>fn<span class="sc">}</span><span class="ss">"</span>, <span class="ss">f"</span><span class="ch">\n</span><span class="ss">False Pos: </span><span class="sc">{</span>fp<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb48-620"><a href="#cb48-620" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-621"><a href="#cb48-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-622"><a href="#cb48-622" aria-hidden="true" tabindex="-1"></a><span class="in">    True Pos: 15 </span></span>
<span id="cb48-623"><a href="#cb48-623" aria-hidden="true" tabindex="-1"></a><span class="in">    False Neg: 26 </span></span>
<span id="cb48-624"><a href="#cb48-624" aria-hidden="true" tabindex="-1"></a><span class="in">    False Pos: 23</span></span>
<span id="cb48-625"><a href="#cb48-625" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb48-626"><a href="#cb48-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-627"><a href="#cb48-627" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model with hyperparameter tuning</span></span>
<span id="cb48-628"><a href="#cb48-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-629"><a href="#cb48-629" aria-hidden="true" tabindex="-1"></a>I've managed to bias the model to improve its specificity. This has resulted in more true positives at the cost of more false positives. But I think I can improve this metric even further by searching through the "hyperparameter space" and considering alternative models that optimize for this metric. This is what I'll do next using random search.</span>
<span id="cb48-630"><a href="#cb48-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-631"><a href="#cb48-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-632"><a href="#cb48-632" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb48-633"><a href="#cb48-633" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameter grid</span></span>
<span id="cb48-634"><a href="#cb48-634" aria-hidden="true" tabindex="-1"></a>gbm_param_grid <span class="op">=</span> {</span>
<span id="cb48-635"><a href="#cb48-635" aria-hidden="true" tabindex="-1"></a>    <span class="st">'n_estimators'</span>: np.arange(<span class="dv">20</span>, <span class="dv">100</span>, <span class="dv">10</span>),</span>
<span id="cb48-636"><a href="#cb48-636" aria-hidden="true" tabindex="-1"></a>    <span class="st">'max_depth'</span>: <span class="bu">range</span>(<span class="dv">2</span>, <span class="dv">10</span>),</span>
<span id="cb48-637"><a href="#cb48-637" aria-hidden="true" tabindex="-1"></a>    <span class="st">'colsample_bytree'</span>: np.arange(<span class="fl">0.1</span>, <span class="fl">1.0</span>, <span class="fl">0.005</span>),</span>
<span id="cb48-638"><a href="#cb48-638" aria-hidden="true" tabindex="-1"></a>    <span class="st">'eta'</span>: np.arange(<span class="fl">0.1</span>, <span class="fl">1.0</span>, <span class="fl">0.01</span>),</span>
<span id="cb48-639"><a href="#cb48-639" aria-hidden="true" tabindex="-1"></a>    <span class="st">'scale_pos_weight'</span>: [imbalance_ratio]</span>
<span id="cb48-640"><a href="#cb48-640" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb48-641"><a href="#cb48-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-642"><a href="#cb48-642" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize regressor</span></span>
<span id="cb48-643"><a href="#cb48-643" aria-hidden="true" tabindex="-1"></a>gbm <span class="op">=</span> XGBClassifier()</span>
<span id="cb48-644"><a href="#cb48-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-645"><a href="#cb48-645" aria-hidden="true" tabindex="-1"></a><span class="co"># Random search</span></span>
<span id="cb48-646"><a href="#cb48-646" aria-hidden="true" tabindex="-1"></a>randomized_mse <span class="op">=</span> RandomizedSearchCV(param_distributions<span class="op">=</span>gbm_param_grid, </span>
<span id="cb48-647"><a href="#cb48-647" aria-hidden="true" tabindex="-1"></a>                                    estimator<span class="op">=</span>gbm, </span>
<span id="cb48-648"><a href="#cb48-648" aria-hidden="true" tabindex="-1"></a>                                    scoring<span class="op">=</span><span class="st">'recall'</span>, </span>
<span id="cb48-649"><a href="#cb48-649" aria-hidden="true" tabindex="-1"></a>                                    n_iter<span class="op">=</span><span class="dv">500</span>, </span>
<span id="cb48-650"><a href="#cb48-650" aria-hidden="true" tabindex="-1"></a>                                    cv<span class="op">=</span><span class="dv">4</span>, </span>
<span id="cb48-651"><a href="#cb48-651" aria-hidden="true" tabindex="-1"></a>                                    random_state<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb48-652"><a href="#cb48-652" aria-hidden="true" tabindex="-1"></a>                                    verbose<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb48-653"><a href="#cb48-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-654"><a href="#cb48-654" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit to data</span></span>
<span id="cb48-655"><a href="#cb48-655" aria-hidden="true" tabindex="-1"></a>randomized_mse.fit(X_train, y_train)</span>
<span id="cb48-656"><a href="#cb48-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-657"><a href="#cb48-657" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the best parameters and lowest RMSE</span></span>
<span id="cb48-658"><a href="#cb48-658" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Best parameters found: "</span>, randomized_mse.best_params_)</span>
<span id="cb48-659"><a href="#cb48-659" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-660"><a href="#cb48-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-661"><a href="#cb48-661" aria-hidden="true" tabindex="-1"></a><span class="in">    Fitting 4 folds for each of 500 candidates, totalling 2000 fits</span></span>
<span id="cb48-662"><a href="#cb48-662" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb48-663"><a href="#cb48-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-664"><a href="#cb48-664" aria-hidden="true" tabindex="-1"></a><span class="in">    [Parallel(n_jobs=1)]: Using backend SequentialBackend with 1 concurrent workers.</span></span>
<span id="cb48-665"><a href="#cb48-665" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb48-666"><a href="#cb48-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-667"><a href="#cb48-667" aria-hidden="true" tabindex="-1"></a><span class="in">    Best parameters found:  {'scale_pos_weight': 6.720588235294118, 'n_estimators': 20, 'max_depth': 2, 'eta': 0.21999999999999995, 'colsample_bytree': 0.49500000000000033}</span></span>
<span id="cb48-668"><a href="#cb48-668" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb48-669"><a href="#cb48-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-670"><a href="#cb48-670" aria-hidden="true" tabindex="-1"></a><span class="in">    [Parallel(n_jobs=1)]: Done 2000 out of 2000 | elapsed:  2.1min finished</span></span>
<span id="cb48-671"><a href="#cb48-671" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb48-672"><a href="#cb48-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-673"><a href="#cb48-673" aria-hidden="true" tabindex="-1"></a><span class="fu">### Test performance</span></span>
<span id="cb48-674"><a href="#cb48-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-675"><a href="#cb48-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-676"><a href="#cb48-676" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb48-677"><a href="#cb48-677" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> randomized_mse.predict(X_test)</span>
<span id="cb48-678"><a href="#cb48-678" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Accuracy: </span><span class="sc">%.2f%%</span><span class="st">"</span> <span class="op">%</span> (accuracy_score(y_test, preds) <span class="op">*</span> <span class="fl">100.0</span>))</span>
<span id="cb48-679"><a href="#cb48-679" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Precision: </span><span class="sc">%.2f%%</span><span class="st">"</span> <span class="op">%</span> (precision_score(y_test, preds) <span class="op">*</span> <span class="fl">100.0</span>))</span>
<span id="cb48-680"><a href="#cb48-680" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Recall: </span><span class="sc">%.2f%%</span><span class="st">"</span> <span class="op">%</span> (recall_score(y_test, preds) <span class="op">*</span> <span class="fl">100.0</span>))</span>
<span id="cb48-681"><a href="#cb48-681" aria-hidden="true" tabindex="-1"></a>plot_roc_curve(randomized_mse, X_test, y_test)</span>
<span id="cb48-682"><a href="#cb48-682" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-683"><a href="#cb48-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-684"><a href="#cb48-684" aria-hidden="true" tabindex="-1"></a><span class="in">    Accuracy: 72.38%</span></span>
<span id="cb48-685"><a href="#cb48-685" aria-hidden="true" tabindex="-1"></a><span class="in">    Precision: 27.00%</span></span>
<span id="cb48-686"><a href="#cb48-686" aria-hidden="true" tabindex="-1"></a><span class="in">    Recall: 65.85%</span></span>
<span id="cb48-687"><a href="#cb48-687" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb48-688"><a href="#cb48-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-689"><a href="#cb48-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-690"><a href="#cb48-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-691"><a href="#cb48-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-692"><a href="#cb48-692" aria-hidden="true" tabindex="-1"></a><span class="in">    &lt;sklearn.metrics._plot.roc_curve.RocCurveDisplay at 0x251159b4a88&gt;</span></span>
<span id="cb48-693"><a href="#cb48-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-694"><a href="#cb48-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-695"><a href="#cb48-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-696"><a href="#cb48-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-697"><a href="#cb48-697" aria-hidden="true" tabindex="-1"></a><span class="al">![png](output_55_2.png)</span></span>
<span id="cb48-698"><a href="#cb48-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-699"><a href="#cb48-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-700"><a href="#cb48-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-701"><a href="#cb48-701" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb48-702"><a href="#cb48-702" aria-hidden="true" tabindex="-1"></a>tn, fp, fn, tp <span class="op">=</span> confusion_matrix(y_test, preds).ravel()</span>
<span id="cb48-703"><a href="#cb48-703" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"True Pos: </span><span class="sc">{</span>tp<span class="sc">}</span><span class="ss">"</span> , <span class="ss">f"</span><span class="ch">\n</span><span class="ss">False Neg: </span><span class="sc">{</span>fn<span class="sc">}</span><span class="ss">"</span>, <span class="ss">f"</span><span class="ch">\n</span><span class="ss">False Pos: </span><span class="sc">{</span>fp<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb48-704"><a href="#cb48-704" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-705"><a href="#cb48-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-706"><a href="#cb48-706" aria-hidden="true" tabindex="-1"></a><span class="in">    True Pos: 27 </span></span>
<span id="cb48-707"><a href="#cb48-707" aria-hidden="true" tabindex="-1"></a><span class="in">    False Neg: 14 </span></span>
<span id="cb48-708"><a href="#cb48-708" aria-hidden="true" tabindex="-1"></a><span class="in">    False Pos: 73</span></span>
<span id="cb48-709"><a href="#cb48-709" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span></code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p><span class="faux-block"><a href="https://creativecommons.org/licenses/by/4.0/"><i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i></a> 2014–2025 Tyler Burleigh</span></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p><span class="faux-block">Made with <i class="fa-brands fa-r-project" aria-label="r-project"></i>, <a href="https://quarto.org/">Quarto</a>, and the <a href="https://github.com/andrewheiss/ath-quarto">ath-quarto</a> theme</span></p>
</div>
  </div>
</footer>




</body></html>